<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Instant Tax Solutions India - Compliance & Advisory</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a' },
                        // New Tool Colors
                        slate: { 850: '#1e293b', 900: '#0f172a' },
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .hidden-section { display: none !important; }
        
        /* New Tool Styles */
        .custom-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(10px); }
        
        .tab-active { color: #2563eb; border-bottom: 2px solid #2563eb; background-color: #eff6ff; }
        .tab-inactive { color: #64748b; border-bottom: 2px solid transparent; }
        .tab-inactive:hover { color: #334155; background-color: #f8fafc; }
        
        @media print {
            aside, nav, #tabsContainer, #banners, #mobileToast, #miniDashboard, #searchInputContainer, .no-print { display: none !important; }
            main { margin: 0; padding: 0; overflow: visible; width: 100%; }
            body { height: auto; overflow: visible; background: white; }
            #listSection { display: block !important; }
            #dashboardSection { display: none !important; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-slate-50 text-gray-800 overflow-hidden">

    <!-- Global Navigation -->
    <nav class="bg-white/90 backdrop-blur border-b border-gray-200 sticky top-0 z-40 shadow-sm flex-none h-16 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex justify-between items-center h-full">
                
                <div class="relative h-12 w-64 cursor-pointer group" onclick="router('home')">
                    
                    <div id="brand-logo" class="absolute inset-0 flex items-center transition-all duration-500 ease-in-out opacity-100 translate-y-0">
                        <svg viewBox="0 0 300 80" class="h-10 w-auto" xmlns="http://www.w3.org/2000/svg">
                            <style>
                                /* Logo Colors matching your brand image */
                                .logo-text { font-family: 'Inter', sans-serif; fill: #001A4B; }
                                .logo-sub { font-family: 'Inter', sans-serif; fill: #001A4B; }
                                .logo-accent { stroke: #25D366; stroke-width: 4; fill: none; stroke-linecap: round; stroke-linejoin: round; }
                            </style>
                            <text x="5" y="45" class="logo-text" font-weight="800" font-size="38" letter-spacing="-1">Instant Tax</text>
                            <path d="M 5 55 L 210 55 L 225 70 L 255 35" class="logo-accent" />
                            <text x="105" y="72" class="logo-sub" font-weight="600" font-size="14" text-anchor="middle">Solutions India</text>
                        </svg>
                    </div>

                    <div id="brand-vision" class="absolute inset-0 flex items-center transition-all duration-500 ease-in-out opacity-0 translate-y-4">
                        <div class="border-l-4 border-brand-600 pl-3">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest leading-none mb-0.5">OUR VISION</p>
                            <p class="text-sm font-bold text-gray-800 italic">"Simplifying Compliance"</p>
                        </div>
                    </div>

                </div>

                <div class="hidden md:flex items-center space-x-8">
                    <button onclick="router('home')" class="text-gray-600 hover:text-brand-600 font-medium transition text-sm">Home</button>
                    <button onclick="router('checklist')" class="text-gray-600 hover:text-brand-600 font-medium transition text-sm">Checklist Tool</button>
                    <button onclick="router('pricing')" class="text-gray-600 hover:text-brand-600 font-medium transition text-sm">Services & Pricing</button>
                    <button onclick="openEnquiryModal('Expert Consultation')" class="bg-brand-600 text-white px-5 py-2 rounded-full hover:bg-brand-700 transition shadow-md text-sm font-semibold">Contact Expert</button>
                </div>
                
                <div class="md:hidden flex items-center">
                    <button onclick="toggleMobileMenu()" class="text-gray-500 hover:text-gray-700 p-2">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-gray-100 px-4 py-2 space-y-2">
            <button onclick="router('home')" class="block w-full text-left py-2 text-gray-600">Home</button>
            <button onclick="router('checklist')" class="block w-full text-left py-2 text-gray-600">Checklist Tool</button>
            <button onclick="router('pricing')" class="block w-full text-left py-2 text-gray-600">Pricing</button>
        </div>
    </nav>

    <!-- ================= VIEW: HOME PAGE ================= -->
    <div id="view-home" class="view-section h-[calc(100vh-64px)] overflow-y-auto">
        <!-- Hero Section -->
        <div class="relative bg-white overflow-hidden">
            <div class="max-w-7xl mx-auto">
                <div class="relative z-10 pb-8 bg-white sm:pb-16 md:pb-20 lg:max-w-2xl lg:w-full lg:pb-28 xl:pb-32 pt-20 px-4 sm:px-6 lg:px-8">
                    <main class="mt-10 mx-auto max-w-7xl sm:mt-12 md:mt-16 lg:mt-20 xl:mt-28">
                        <div class="sm:text-center lg:text-left">
                            <span class="inline-block py-1 px-3 rounded-full bg-brand-50 text-brand-600 text-xs font-bold tracking-wide uppercase mb-4">FY 2024-25 Compliances</span>
                            <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
                                <span class="block xl:inline">Simplified Tax</span>
                                <span class="block text-brand-600 xl:inline">Compliances India</span>
                            </h1>
                            <p class="mt-3 text-base text-gray-500 sm:mt-5 sm:text-lg sm:max-w-xl sm:mx-auto md:mt-5 md:text-xl lg:mx-0">
                                Navigate the complex regulatory landscape of India. Get instant compliance checks, expert litigation support, and seamless filing services.
                            </p>
                            <div class="mt-5 sm:mt-8 sm:flex sm:justify-center lg:justify-start">
                                <div class="rounded-md shadow">
                                    <button onclick="router('checklist')" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-brand-600 hover:bg-brand-700 md:py-4 md:text-lg transition-all transform hover:-translate-y-0.5">
                                        Check Compliance
                                    </button>
                                </div>
                                <div class="mt-3 sm:mt-0 sm:ml-3">
                                    <button onclick="router('pricing')" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-brand-700 bg-brand-100 hover:bg-brand-200 md:py-4 md:text-lg transition-all">
                                        View Pricing
                                    </button>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
            <div class="lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2 bg-gray-50 flex items-center justify-center border-l border-gray-100">
                <div class="relative w-full h-full flex items-center justify-center overflow-hidden">
                    <i class="fa-solid fa-file-invoice-dollar text-brand-100 text-[15rem] absolute transform -rotate-12"></i>
                    <i class="fa-solid fa-calculator text-blue-50 text-[10rem] absolute top-20 right-20 transform rotate-12"></i>
                </div>
            </div>
        </div>

        <!-- Features Grid -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 bg-slate-50">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-extrabold text-gray-900">Explore Our Tools</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Compliance Checklist Box -->
                <div onclick="router('checklist')" class="cursor-pointer group relative bg-white border-2 border-brand-500 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="absolute top-0 right-0 -mt-3 -mr-3 bg-gradient-to-r from-brand-600 to-brand-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg">FREE TOOL</div>
                    <div class="flex items-center mb-4">
                        <div class="bg-brand-100 p-4 rounded-xl text-brand-600 mr-5 group-hover:bg-brand-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-list-check text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Regulatory Checklist</h3>
                            <p class="text-xs text-brand-600 font-semibold uppercase tracking-wider">Instant Generator</p>
                        </div>
                    </div>
                    <p class="text-gray-600 mb-6 text-sm leading-relaxed">
                        Instantly generate a customized roadmap of tax and MCA compliances based on your entity type and turnover. Know your due dates for ITR, GST, and ROC.
                    </p>
                    <span class="text-brand-600 font-bold text-sm flex items-center group-hover:underline">
                        Start Check <i class="fa-solid fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </div>

                <!-- Pricing Box -->
                <div onclick="router('pricing')" class="cursor-pointer group bg-white border border-gray-200 rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="flex items-center mb-4">
                        <div class="bg-green-50 p-4 rounded-xl text-green-600 mr-5 group-hover:bg-green-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-tags text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Services & Pricing</h3>
                            <p class="text-xs text-green-600 font-semibold uppercase tracking-wider">Transparent Rates</p>
                        </div>
                    </div>
                    <p class="text-gray-600 mb-6 text-sm leading-relaxed">
                        Transparent, unbundled pricing for Returns, GST, Registrations, and Advisory. No hidden costs. Pay only for what you need.
                    </p>
                    <span class="text-green-600 font-bold text-sm flex items-center group-hover:underline">
                        View Rates <i class="fa-solid fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Why Choose Us Section -->
        <div class="bg-white border-t border-slate-200 py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-extrabold text-gray-900">Why choose Instant Tax Solutions?</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12 text-center divide-y md:divide-y-0 md:divide-x divide-slate-100">
                    <div class="p-4">
                        <div class="mx-auto w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center text-green-600 mb-4 text-2xl shadow-sm">
                            <i class="fa-solid fa-calendar-check"></i>
                        </div>
                        <h4 class="font-bold text-slate-900 text-lg">Always Up-to-Date</h4>
                        <p class="text-sm text-slate-500 mt-2 px-4">Our compliance engine is updated in real-time with the latest Finance Acts and notifications.</p>
                    </div>
                    <div class="p-4 pt-12 md:pt-4">
                        <div class="mx-auto w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center text-brand-600 mb-4 text-2xl shadow-sm">
                            <i class="fa-solid fa-user-tie"></i>
                        </div>
                        <h4 class="font-bold text-slate-900 text-lg">Expert Assisted</h4>
                        <p class="text-sm text-slate-500 mt-2 px-4">Filings reviewed by verified CAs and tax experts to ensure zero errors.</p>
                    </div>
                    <div class="p-4 pt-12 md:pt-4">
                        <div class="mx-auto w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center text-purple-600 mb-4 text-2xl shadow-sm">
                            <i class="fa-solid fa-bolt"></i>
                        </div>
                        <h4 class="font-bold text-slate-900 text-lg">Fast Turnaround</h4>
                        <p class="text-sm text-slate-500 mt-2 px-4">Get your compliances sorted in record time with our automated workflows.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="bg-slate-900 text-slate-400 py-8 text-center text-sm">
            <p>&copy; 2025 Instant Tax Solutions India. All rights reserved.</p>
        </footer>
    </div>

    <!-- ================= VIEW: CHECKLIST TOOL v2 ================= -->
    <div id="view-checklist" class="view-section hidden-section h-[calc(100vh-64px)] flex flex-col relative text-slate-800 bg-slate-50">
        
        <!-- TOOL TOP TOOLBAR -->
        <header class="glass-panel h-16 z-30 flex-none no-print shadow-sm bg-white/95">
            <div class="h-full px-4 sm:px-6 flex items-center justify-between max-w-[1600px] mx-auto">
                <!-- Replaced duplicate logo with Breadcrumb/Title -->
                <div class="flex items-center gap-2">
                    <span class="text-sm font-medium text-slate-500">Tools</span>
                    <i class="ph ph-caret-right text-xs text-slate-400"></i>
                    <h1 class="text-sm font-bold text-slate-900">Compliance Master</h1>
                </div>
                
                <div class="flex items-center gap-3">
                    <button onclick="if(window.app) window.app.downloadCSV()" class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-xs font-semibold text-slate-600 hover:border-primary-500 hover:text-primary-600 transition-all shadow-sm">
                        <i class="ph ph-download-simple text-sm"></i> Export
                    </button>
                    <button onclick="window.print()" class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-xs font-semibold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
                        <i class="ph ph-printer text-sm"></i> Print
                    </button>
                    <button onclick="window.app.toggleSidebar()" class="lg:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg">
                        <i class="ph ph-faders text-xl"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden max-w-[1600px] mx-auto w-full relative">
            
            <div id="drawerBackdrop" onclick="if(window.app) window.app.toggleSidebar()" class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 hidden lg:hidden transition-opacity opacity-0 no-print"></div>
            
            <aside id="configSidebar" class="fixed inset-y-0 left-0 z-50 w-80 bg-white border-r border-slate-200 shadow-2xl lg:shadow-none transform -translate-x-full lg:translate-x-0 lg:static transition-transform duration-300 flex flex-col h-full no-print">
                <div class="p-4 border-b border-slate-100 flex items-center justify-between lg:hidden">
                    <span class="font-bold text-slate-900">Configure Entity</span>
                    <button onclick="window.app.toggleSidebar()" class="text-slate-400"><i class="ph ph-x text-xl"></i></button>
                </div>

                <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-8">
                    <div class="space-y-3">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                            <i class="ph ph-buildings"></i> Profile
                        </h3>
                        <select id="entityType" onchange="window.app.updateFields()" class="w-full bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 block p-2.5 transition-all font-medium">
                            <option value="Private Limited">Private Limited Co.</option>
                            <option value="LLP">LLP / Partnership</option>
                            <option value="Individual">Individual / Proprietor</option>
                            <option value="Public Limited">Public Limited Co.</option>
                            <option value="Listed">Listed Company</option>
                            <option value="Section 8">Section 8 / Trust</option>
                            <option value="Foreign Co">Foreign Subsidiary</option>
                        </select>
                        
                        <div id="indivTypeField" class="hidden animate-fade-in space-y-2">
                            <select id="indivType" class="w-full bg-slate-50 border border-slate-200 text-slate-600 text-xs rounded-lg p-2.5">
                                <option value="Business">Business (Trader/Mfr)</option>
                                <option value="Professional">Professional</option>
                            </select>
                            <label class="flex items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer transition-colors">
                                <input type="checkbox" id="isDirector" class="w-4 h-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500">
                                <span class="ml-2 text-xs font-medium text-slate-600">Do you hold a DIN?</span>
                            </label>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                            <i class="ph ph-chart-line-up"></i> Financials
                        </h3>
                        <div class="grid grid-cols-1 gap-3">
                            <div>
                                <label class="text-[10px] text-slate-500 font-medium mb-1 block">Annual Turnover</label>
                                <select id="turnover" class="w-full bg-slate-50 border border-slate-200 text-slate-600 text-xs rounded-lg p-2.5">
                                    <option value="1500000">&lt; ₹20 Lakhs</option>
                                    <option value="4000000">₹20L - ₹40L</option>
                                    <option value="12000000">₹40L - ₹1.5 Cr</option>
                                    <option value="25000000">₹1.5 Cr - ₹3 Cr</option>
                                    <option value="75000000">₹5 Cr - ₹10 Cr</option>
                                    <option value="2000000000">₹10 Cr - ₹500 Cr</option>
                                    <option value="6000000000"> > ₹500 Cr</option>
                                </select>
                            </div>
                            <div id="capitalField">
                                <label class="text-[10px] text-slate-500 font-medium mb-1 block">Paid-up Capital</label>
                                <select id="capital" class="w-full bg-slate-50 border border-slate-200 text-slate-600 text-xs rounded-lg p-2.5">
                                    <option value="100000">Small (&lt; ₹10L)</option>
                                    <option value="50000000">Medium (&lt; ₹10 Cr)</option>
                                    <option value="150000000">Large (&gt; ₹10 Cr)</option>
                                    <option value="550000000">Very Large (&gt; ₹50 Cr)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                            <i class="ph ph-sliders"></i> Scope
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasGST" checked class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">GST Reg</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasTAN" checked class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">TAN / TDS</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasPayroll" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">Payroll</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="isExport" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">Exports/SEZ</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasImport" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">Imports</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="isStartup" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">Startup</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasMSME" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">MSME</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasFDI" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">FDI/TP</span>
                            </label>
                             <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="hasRPT" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">Rel. Party</span>
                            </label>
                            <label class="relative flex cursor-pointer items-center p-2 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50 has-[:checked]:text-primary-700">
                                <input type="checkbox" id="isNewInc" class="peer sr-only">
                                <span class="text-xs font-medium text-slate-600 peer-checked:text-primary-700 w-full text-center">New Inc.</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="p-4 border-t border-slate-200 bg-slate-50/50 backdrop-blur-sm">
                    <button id="runBtn" onclick="window.app.manualRun()" class="w-full bg-slate-900 hover:bg-black text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-slate-300 transform active:scale-95 transition-all flex items-center justify-center gap-2 duration-200">
                        <i class="ph ph-lightning text-lg"></i> Run Analysis
                    </button>
                    <button onclick="if(window.app) window.app.resetAll()" class="mt-2 w-full text-xs text-slate-400 hover:text-slate-600 underline text-center">
                        Reset to Defaults
                    </button>
                </div>
            </aside>

            <main id="mainContent" class="flex-1 flex flex-col min-w-0 bg-slate-50/50 relative overflow-hidden scroll-smooth">
                
                <!-- NEW: INITIAL INSTRUCTION STATE -->
                <div id="initialInstruction" class="flex-1 flex flex-col items-center justify-center p-8 text-center h-full animate-in fade-in zoom-in duration-300">
                    <div class="w-24 h-24 bg-brand-50 rounded-full flex items-center justify-center mb-6 shadow-sm ring-1 ring-brand-100">
                        <i class="ph ph-sliders text-4xl text-brand-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-3">Configure Your Profile</h2>
                    <p class="text-slate-500 max-w-md mx-auto leading-relaxed mb-8 text-sm">
                        To generate your customized compliance checklist, please select your entity type and financials using the <span class="font-bold text-slate-700 whitespace-nowrap"><i class="ph ph-faders mx-1 text-brand-600"></i> Filter Icon</span> (or the sidebar on desktop).
                        <br><br>
                        Once selected, click <span class="font-bold text-brand-600 bg-brand-50 px-2 py-1 rounded">Run Analysis</span> to view results.
                    </p>
                    <button onclick="if(window.app) window.app.toggleSidebar()" class="lg:hidden inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-xl text-white bg-brand-600 hover:bg-brand-700 shadow-lg shadow-brand-500/30 transition-all">
                        Open Filters
                    </button>
                </div>

                <div id="tabsWrapper" class="bg-white border-b border-slate-200 shadow-sm z-20 no-print sticky top-0 hidden">
                    <div class="px-6 py-4">
                        <div class="relative max-w-2xl group">
                            <i class="ph ph-magnifying-glass absolute left-3.5 top-3 text-slate-400 text-lg group-focus-within:text-primary-500 transition-colors"></i>
                            <input type="text" id="searchInput" onkeyup="window.app.render()" placeholder="Search form, section, or compliance..." class="w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent border rounded-xl text-sm font-medium text-slate-800 focus:ring-2 focus:ring-primary-500 focus:bg-white focus:border-white transition-all placeholder:text-slate-400">
                        </div>
                    </div>
                    
                    <nav class="flex overflow-x-auto custom-scroll px-6 gap-4" id="tabsContainer">
                        </nav>
                </div>

                <div id="dashboardSection" class="hidden flex-1 overflow-y-auto custom-scroll p-4 sm:p-8 space-y-8 animate-fade-in-up">
                    
                    <div class="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-6 sm:p-8 text-white shadow-xl flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16 group-hover:bg-white/10 transition-colors duration-500"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold mb-1">Compliance Applicable to you</h2>
                            <p class="text-slate-400 text-sm">FY 2025-26 Legal Framework. <span class="text-primary-400 font-semibold" id="entityDisplay">Private Limited</span></p>
                        </div>
                        <div class="relative z-10 flex items-center gap-6">
                             <div class="text-right">
                                 <div class="text-3xl font-bold" id="totalCount">0</div>
                                 <div class="text-[10px] uppercase tracking-wider text-slate-400">Total Oblg.</div>
                             </div>
                             <div class="h-10 w-px bg-white/20"></div>
                             <div class="text-right">
                                 <div class="text-3xl font-bold text-red-400" id="highRiskCount">0</div>
                                 <div class="text-[10px] uppercase tracking-wider text-slate-400">High Penalty</div>
                             </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-card flex flex-col items-center justify-start min-h-[320px]">
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 self-start flex items-center gap-2"><i class="ph ph-chart-pie-slice"></i> Distribution</h3>
                            <div class="w-full h-56 relative flex-shrink-0">
                                <canvas id="complianceChart"></canvas>
                            </div>
                            <!-- NEW: Summary List -->
                            <div id="chartSummary" class="w-full mt-6 pt-4 border-t border-slate-100 grid grid-cols-2 gap-x-4 gap-y-2">
                                <!-- Injected by JS -->
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2 grid grid-cols-2 sm:grid-cols-3 gap-4" id="categoryGrid">
                            </div>
                    </div>
                </div>

                <div id="listSection" class="hidden flex-1 overflow-y-auto custom-scroll p-4 sm:p-6 pb-24">
                    <div id="resultsHeader" class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-slate-800">Compliance Checklist</h3>
                        <span id="resultsCount" class="text-xs font-semibold bg-slate-200 text-slate-600 px-3 py-1 rounded-full">0 Found</span>
                    </div>

                    <div id="complianceBody" class="space-y-3"></div>
                    
                    <div id="emptyState" class="hidden text-center py-20 animate-fade-in-up">
                          <div class="bg-slate-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400 text-3xl">
                              <i class="ph ph-clipboard-text"></i>
                          </div>
                          <h3 class="text-slate-900 font-bold text-lg">No Records Found</h3>
                          <p class="text-slate-500 text-sm mt-1 max-w-xs mx-auto">Try adjusting your filters in the sidebar or search for a different keyword.</p>
                    </div>
                </div>

            </main>
        </div>

        <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-xl shadow-2xl flex items-center gap-3 z-[100] transition-all duration-300 translate-y-24 opacity-0">
            <i class="ph ph-check-circle text-green-400 text-xl"></i>
            <span class="text-sm font-medium">Analysis Updated Successfully</span>
        </div>

        <div id="infoModal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
            <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity duration-300" onclick="window.app.closeModal()"></div>
            <div class="fixed inset-0 z-10 overflow-y-auto">
                <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                    <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 w-full sm:max-w-xl h-[500px] scale-95 opacity-0 duration-300 ease-out flex flex-col" id="modalContent">
                        
                        <div class="bg-white px-6 py-5 border-b border-slate-100 flex-none">
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-primary-50">
                                    <i class="ph ph-info text-2xl text-primary-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold leading-6 text-slate-900" id="modalTitle">Title</h3>
                                    <div class="mt-1 flex gap-2">
                                        <span id="modalAct" class="text-[10px] font-bold bg-slate-100 text-slate-600 px-2 py-0.5 rounded uppercase tracking-wider">Act</span>
                                        <span id="modalForm" class="text-[10px] font-bold bg-blue-50 text-blue-600 px-2 py-0.5 rounded font-mono border border-blue-100">Form</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 overflow-y-auto custom-scroll px-6 py-4 space-y-5">
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1.5">Description</label>
                                <p class="text-sm text-slate-700 leading-relaxed" id="modalDesc">...</p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-3 rounded-lg border border-slate-100 bg-white">
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Due Date</label>
                                    <p class="text-sm font-bold text-slate-900" id="modalDate">...</p>
                                </div>
                                <div class="p-3 rounded-lg border border-slate-100 bg-white">
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Frequency</label>
                                    <p class="text-sm font-medium text-slate-900" id="modalFreq">...</p>
                                </div>
                            </div>
                            
                            <div class="bg-red-50 p-4 rounded-xl border border-red-100 flex gap-3 items-start">
                                <i class="ph ph-warning text-red-600 text-lg mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <label class="text-[10px] font-bold text-red-700 uppercase tracking-wider block mb-1">Penalty Risk</label>
                                    <p class="text-xs text-red-800 font-medium leading-relaxed" id="modalPenalty">...</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-50 px-6 py-4 border-t border-slate-100 flex-none flex flex-col-reverse sm:flex-row-reverse gap-3 sm:gap-0">
                            <button type="button" class="inline-flex w-full sm:w-auto justify-center rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-black sm:ml-3 transition-colors duration-200" onclick="window.app.closeModal()">Close Details</button>
                            <button type="button" class="inline-flex w-full sm:w-auto justify-center rounded-xl bg-primary-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primary-700 transition-colors duration-200" onclick="window.app.getPricing()">Get Pricing Details</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= VIEW: PRICING ================= -->
    <div id="view-pricing" class="view-section hidden-section h-[calc(100vh-64px)] overflow-y-auto">
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Breadcrumb -->
            <div class="mb-6 flex items-center text-sm text-gray-500">
                <button onclick="router('home')" class="hover:text-brand-600">Home</button>
                <i class="fa-solid fa-chevron-right mx-2 text-xs"></i>
                <span class="font-semibold text-gray-900">Pricing</span>
            </div>

            <div class="text-center max-w-3xl mx-auto mb-12">
                <h2 class="text-3xl font-extrabold text-gray-900">Transparent Service Rates</h2>
                <p class="mt-4 text-lg text-gray-500">Choose the specific service you need. No bundled nonsense, just clear, flat-fee pricing.</p>
            </div>

            <!-- Pricing Tabs -->
            <div class="flex justify-center mb-8">
                <div class="bg-gray-100 p-1 rounded-xl inline-flex overflow-x-auto max-w-full">
                    <button onclick="switchPricing('subscription')" id="tab-subscription" class="whitespace-nowrap px-6 py-2.5 rounded-lg text-sm font-medium transition-all bg-white text-gray-900 shadow-sm ring-1 ring-black/5">Return filings and incorporation</button>
                    <button onclick="switchPricing('bookkeeping')" id="tab-bookkeeping" class="whitespace-nowrap px-6 py-2.5 rounded-lg text-sm font-medium transition-all text-gray-500 hover:text-gray-900">Bookkeeping</button>
                    <button onclick="switchPricing('litigation')" id="tab-litigation" class="whitespace-nowrap px-6 py-2.5 rounded-lg text-sm font-medium transition-all text-gray-500 hover:text-gray-900">Litigation</button>
                    <button onclick="switchPricing('advisory')" id="tab-advisory" class="whitespace-nowrap px-6 py-2.5 rounded-lg text-sm font-medium transition-all text-gray-500 hover:text-gray-900">Advisory</button>
                </div>
            </div>

            <!-- Content: Subscription -->
            <div id="pricing-subscription" class="pricing-content animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Income Tax -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition relative overflow-hidden group">
                        <div class="h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 mb-4"><i class="fa-solid fa-file-invoice"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Income Tax Return</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Filing of ITR-1 to ITR-6 assisted by CA.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹1,500 onwards</span>
                            <span class="text-gray-400 text-sm block">per filing</span>
                            <button onclick="openEnquiryModal('Income Tax Return')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- TDS -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-indigo-100 rounded-lg flex items-center justify-center text-indigo-600 mb-4"><i class="fa-solid fa-percent"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">TDS / TCS Returns</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Quarterly filing of Form 24Q, 26Q.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹2,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per quarter</span>
                            <button onclick="openEnquiryModal('TDS Returns')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- GST -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 mb-4"><i class="fa-solid fa-shop"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">GST Filings</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Monthly GSTR-1 & 3B filing support.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹1,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per month</span>
                            <button onclick="openEnquiryModal('GST Filings')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- Incorporation -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600 mb-4"><i class="fa-solid fa-building"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Company Incorporation</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Pvt Ltd / LLP Registration (pro fees only).</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹7,000 onwards</span>
                            <span class="text-gray-400 text-sm block">one-time</span>
                            <button onclick="openEnquiryModal('Company Incorporation')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- MCA -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-teal-100 rounded-lg flex items-center justify-center text-teal-600 mb-4"><i class="fa-solid fa-book"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">MCA Annual Filing</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">AOC-4 and MGT-7 filings.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹5,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per year</span>
                            <button onclick="openEnquiryModal('MCA Filing')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                      <!-- TP -->
                      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 mb-4"><i class="fa-solid fa-globe"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Transfer Pricing</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Documentation & Filing Form 3CEB.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹15,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per filing</span>
                            <button onclick="openEnquiryModal('Transfer Pricing')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content: Bookkeeping (NEW) -->
            <div id="pricing-bookkeeping" class="pricing-content hidden-section animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Monthly Bookkeeping -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-cyan-100 rounded-lg flex items-center justify-center text-cyan-600 mb-4"><i class="fa-solid fa-book-open"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Monthly Bookkeeping</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Recording transactions, categorization, and bank reconciliation.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹2,500 onwards</span>
                            <span class="text-gray-400 text-sm block">per month</span>
                            <button onclick="openEnquiryModal('Monthly Bookkeeping')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- Financial Statements -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-emerald-100 rounded-lg flex items-center justify-center text-emerald-600 mb-4"><i class="fa-solid fa-file-contract"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Financial Statements</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Preparation of Balance Sheet, P&L, and Cash Flow Statement.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹5,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per year</span>
                            <button onclick="openEnquiryModal('Financial Statements')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- MIS Reporting -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-violet-100 rounded-lg flex items-center justify-center text-violet-600 mb-4"><i class="fa-solid fa-chart-line"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">MIS Reporting</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Customized performance reports for management review.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹3,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per report</span>
                            <button onclick="openEnquiryModal('MIS Reporting')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- Inventory Management -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-amber-100 rounded-lg flex items-center justify-center text-amber-600 mb-4"><i class="fa-solid fa-boxes-stacked"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Inventory Accounting</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Stock tracking, valuation, and reconciliation support.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹4,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per month</span>
                            <button onclick="openEnquiryModal('Inventory Accounting')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- Payroll Processing -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-pink-100 rounded-lg flex items-center justify-center text-pink-600 mb-4"><i class="fa-solid fa-users-gear"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Payroll Processing</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">Salary calculation, slip generation, and compliance.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹1,500 onwards</span>
                            <span class="text-gray-400 text-sm block">per month</span>
                            <button onclick="openEnquiryModal('Payroll Processing')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                    <!-- Virtual CFO -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="h-10 w-10 bg-slate-100 rounded-lg flex items-center justify-center text-slate-700 mb-4"><i class="fa-solid fa-user-tie"></i></div>
                        <h3 class="text-lg font-bold text-gray-900">Virtual CFO</h3>
                        <p class="text-sm text-gray-500 mt-2 h-10">High-level financial strategy, budgeting, and oversight.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="text-2xl font-bold text-gray-900">₹15,000 onwards</span>
                            <span class="text-gray-400 text-sm block">per month</span>
                            <button onclick="openEnquiryModal('Virtual CFO')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Enquire Now</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content: Litigation -->
            <div id="pricing-litigation" class="pricing-content hidden-section animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto">
                    
                    <!-- Notice Management -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition flex flex-col">
                        <div class="h-12 w-12 bg-yellow-100 rounded-lg flex items-center justify-center text-yellow-600 mb-4">
                            <i class="fa-solid fa-envelope-open-text text-xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900">Notice Management</h3>
                        <p class="text-sm text-gray-500 mt-2 flex-1">Expert drafting of responses to Income Tax (133(6), 148) or GST (ASMT-10) notices.</p>
                        <div class="mt-6 pt-4 border-t border-gray-100">
                            <div class="flex items-baseline">
                                <span class="text-2xl font-bold text-gray-900">₹2,500</span>
                                <span class="text-gray-500 text-sm ml-1">onwards</span>
                            </div>
                            <button onclick="openEnquiryModal('Notice Management')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">Get Assistance</button>
                        </div>
                    </div>

                    <!-- Scrutiny Assessment -->
                    <div class="bg-white rounded-xl shadow-md border-2 border-brand-100 p-6 hover:shadow-lg transition flex flex-col relative overflow-hidden ring-1 ring-brand-50">
                        <div class="absolute top-0 right-0 bg-brand-600 text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg tracking-wide">HIGH PRIORITY</div>
                        <div class="h-12 w-12 bg-brand-100 rounded-lg flex items-center justify-center text-brand-600 mb-4">
                            <i class="fa-solid fa-magnifying-glass-chart text-xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900">Scrutiny Assessment</h3>
                        <p class="text-sm text-gray-500 mt-2 flex-1">End-to-end representation for Section 143(3) proceedings. Includes submissions and video hearings.</p>
                        <div class="mt-6 pt-4 border-t border-gray-100">
                            <div class="flex items-baseline">
                                <span class="text-2xl font-bold text-gray-900">₹15,000</span>
                                <span class="text-gray-500 text-sm ml-1">onwards</span>
                            </div>
                            <button onclick="openEnquiryModal('Scrutiny Assessment')" class="mt-4 w-full bg-brand-600 text-white font-semibold py-2 rounded-lg hover:bg-brand-700 transition text-sm shadow-sm">Consult Expert</button>
                        </div>
                    </div>

                    <!-- Appeals -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition flex flex-col">
                        <div class="h-12 w-12 bg-red-100 rounded-lg flex items-center justify-center text-red-600 mb-4">
                            <i class="fa-solid fa-gavel text-xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900">Appeals (CIT / GST)</h3>
                        <p class="text-sm text-gray-500 mt-2 flex-1">Drafting Statement of Facts, Grounds of Appeal, and representation before Commissioner (Appeals).</p>
                        <div class="mt-6 pt-4 border-t border-gray-100">
                            <div class="flex items-baseline">
                                <span class="text-2xl font-bold text-gray-900">₹25,000</span>
                                <span class="text-gray-500 text-sm ml-1">onwards</span>
                            </div>
                            <button onclick="openEnquiryModal('Appeals Filing')" class="mt-4 w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 transition text-sm">File Appeal</button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Content: Advisory -->
            <div id="pricing-advisory" class="pricing-content hidden-section animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                    <div class="bg-white rounded-xl p-8 border border-gray-200 shadow-sm flex flex-col items-center text-center hover:shadow-lg transition">
                        <div class="h-16 w-16 bg-brand-50 rounded-full flex items-center justify-center text-brand-600 text-2xl mb-6">
                            <i class="fa-solid fa-headset"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4">On-Call Advisory</h3>
                        <p class="text-gray-600 mb-6 text-sm">Expert opinion on specific tax queries via video/voice call.</p>
                        <button onclick="openEnquiryModal('On-Call Advisory')" class="w-full mt-auto bg-brand-600 text-white font-semibold py-2.5 rounded-lg hover:bg-brand-700 transition">Book Slot</button>
                    </div>
                    <div class="bg-white rounded-xl p-8 border border-gray-200 shadow-sm flex flex-col items-center text-center hover:shadow-lg transition">
                        <div class="h-16 w-16 bg-gray-50 rounded-full flex items-center justify-center text-gray-700 text-2xl mb-6">
                            <i class="fa-solid fa-handshake"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Transaction Structuring</h3>
                        <p class="text-gray-600 mb-6 text-sm">Tax planning for mergers, acquisitions, or complex contracts.</p>
                        <button onclick="openEnquiryModal('Transaction Structuring')" class="w-full mt-auto bg-gray-800 text-white font-semibold py-2.5 rounded-lg hover:bg-gray-900 transition">Contact Us</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ENQUIRY MODAL -->
    <div id="enquiryModal" class="fixed inset-0 z-[70] hidden overflow-y-auto no-print" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" aria-hidden="true" onclick="closeEnquiryModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md w-full ring-1 ring-black/5">
                <div class="bg-white px-6 pt-6 pb-6">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <i class="fa-solid fa-check text-green-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg leading-6 font-bold text-slate-900" id="enquiryModalTitle">Thank You!</h3>
                        <div class="mt-4">
                            <p class="text-sm text-slate-500 mb-4">
                                We appreciate your interest in <span id="enquiryServiceName" class="font-semibold text-slate-700">our services</span>.
                            </p>
                            <p class="text-sm text-slate-600 mb-2">
                                Please write to us with your specific needs at:
                            </p>
                            <div class="bg-slate-50 p-3 rounded-lg border border-slate-200 mb-4 flex items-center justify-between">
                                <span class="text-sm font-bold text-brand-700 select-all">instanttaxsolutionsindia@gmail.com</span>
                                <button onclick="navigator.clipboard.writeText('instanttaxsolutionsindia@gmail.com'); alert('Email copied!');" class="text-slate-400 hover:text-brand-600">
                                    <i class="fa-regular fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-slate-400 italic">
                                We shall get back to you shortly.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-col sm:gap-2">
                    <a id="enquiryMailLink" href="#" class="w-full inline-flex justify-center rounded-xl border border-transparent shadow-sm px-4 py-2 bg-brand-600 text-base font-medium text-white hover:bg-brand-700 focus:outline-none sm:text-sm transition-colors">
                        <i class="fa-solid fa-envelope mr-2 mt-0.5"></i> Open Mail App
                    </a>
                    <button type="button" class="mt-2 w-full inline-flex justify-center rounded-xl border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none sm:mt-0 sm:text-sm transition-colors" onclick="closeEnquiryModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // --- Firebase Configuration (Placeholder - Replace with your own!) ---
        const firebaseConfig = {
            apiKey: "AIzaSyD-YOUR-API-KEY-HERE",
            authDomain: "instant-tax-india.firebaseapp.com",
            projectId: "instant-tax-india",
            storageBucket: "instant-tax-india.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            console.log("Firebase Initialized");
        } catch (e) {
            console.log("Firebase not configured properly for demo. Local Mocking enabled.");
        }

        // --- Navigation Router ---
        function router(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden-section'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden-section');
            window.scrollTo(0, 0);
            
            // Close mobile menu if open
            document.getElementById('mobile-menu').classList.add('hidden');

            // Initialize App if checklist view
            if(viewName === 'checklist' && window.app) {
                window.app.loadState();
                window.app.updateFields();
                // Check if already run, if so render results, else show instruction
                if(window.app.hasRun) {
                    window.app.render();
                }
            }
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // --- Pricing Tab Logic ---
        function switchPricing(category) {
            ['subscription', 'litigation', 'advisory', 'bookkeeping'].forEach(cat => {
                const btn = document.getElementById(`tab-${cat}`);
                if (cat === category) {
                    btn.classList.remove('text-gray-500', 'hover:text-gray-900');
                    btn.classList.add('bg-white', 'text-gray-900', 'shadow-sm', 'ring-1', 'ring-black/5');
                } else {
                    btn.classList.add('text-gray-500', 'hover:text-gray-900');
                    btn.classList.remove('bg-white', 'text-gray-900', 'shadow-sm', 'ring-1', 'ring-black/5');
                }
            });
            document.querySelectorAll('.pricing-content').forEach(el => el.classList.add('hidden-section'));
            document.getElementById(`pricing-${category}`).classList.remove('hidden-section');
        }

        // --- COMPLIANCE MASTER V2 LOGIC ---
        const complianceData = [
            // 1. NEW INCORPORATION
            { cat: "CORP", title: "First Auditor Appt", form: "ADT-1", freq: "One-Time", date: "30 Days Inc", act: "Companies Act, 2013", desc: "Appointment of First Auditor by Board.", penalty: "Fine.", logic: { type: ["Private Limited", "Public Limited", "Listed", "Section 8"], newInc: true } },
            { cat: "CORP", title: "Commencement of Biz", form: "INC-20A", freq: "One-Time", date: "180 Days Inc", act: "Companies Act, 2013", desc: "Declaration that subcribers have paid capital.", penalty: "₹50k + ₹1000/day.", logic: { type: ["Private Limited", "Public Limited"], newInc: true } },

            // 2. DIRECTORS & GOVERNANCE
            { cat: "DIR_COMM", title: "Min. Directors (Pvt)", form: "Sec 149", freq: "Continuous", date: "N/A", act: "Companies Act, 2013", desc: "Private Companies must maintain a minimum of 2 directors.", penalty: "Penalty on company/officer.", logic: { type: ["Private Limited", "Section 8"] } },
            { cat: "DIR_COMM", title: "Min. Directors (Public)", form: "Sec 149", freq: "Continuous", date: "N/A", act: "Companies Act, 2013", desc: "Public Companies must maintain a minimum of 3 directors.", penalty: "Penalty on company/officer.", logic: { type: ["Public Limited", "Listed"] } },
            { cat: "DIR_COMM", title: "Resident Director", form: "Sec 149(3)", freq: "Annual", date: "Continuous", act: "Companies Act, 2013", desc: "One director must stay in India for ≥ 182 days.", penalty: "Fine ₹50k - ₹5L.", logic: { type: ["Private Limited", "Public Limited", "Listed", "Section 8"] } },
            { cat: "DIR_COMM", title: "Disclosure of Interest", form: "MBP-1", freq: "Annual", date: "1st Board Meeting", act: "Companies Act, 2013", desc: "Disclosure of interest in other entities (Sec 184).", penalty: "Vacation of office; Fine up to ₹1L.", logic: { type: ["Private Limited", "Public Limited", "Listed", "Section 8"] } },
            { cat: "DIR_COMM", title: "Non-Disqualification", form: "DIR-8", freq: "Annual", date: "1st Board Meeting", act: "Companies Act, 2013", desc: "Declaration that director is not disqualified u/s 164(2).", penalty: "Disqualification.", logic: { type: ["Private Limited", "Public Limited", "Listed", "Section 8"] } },
            { cat: "DIR_COMM", title: "DIR-3 KYC (Personal)", form: "DIR-3", freq: "Annual", date: "30th Sept", act: "Companies Act, 2013", desc: "Personal KYC for Directors (DIN holders).", penalty: "DIN Deactivation + ₹5000.", logic: { type: ["Individual"], director: true } },

            // Specialized Directors
            { cat: "DIR_COMM", title: "Woman Director", form: "Sec 149(1)", freq: "Continuous", date: "N/A", act: "Companies Act, 2013", desc: "Mandatory for Listed Cos & Public Cos (Paid-up ≥ 100Cr OR Turnover ≥ 300Cr).", penalty: "Fine up to ₹5L.", logic: { type: ["Listed", "Public Limited"], minTurnover: 3000000000 } },
            { cat: "DIR_COMM", title: "Independent Directors", form: "Sec 149(4)", freq: "Continuous", date: "N/A", act: "Companies Act, 2013", desc: "Listed: 1/3 Board. Public: Min 2 (Capital≥10Cr, T/O≥100Cr, Loans≥50Cr).", penalty: "Invalid Board Composition.", logic: { type: ["Listed", "Public Limited"], highValue: true } },
            { cat: "DIR_COMM", title: "Indep. Woman Director", form: "Reg 17(1)", freq: "Continuous", date: "N/A", act: "SEBI LODR", desc: "Top 1000 Listed Entities.", penalty: "SEBI Fines.", logic: { type: ["Listed"] } },
            
            // Committees
            { cat: "DIR_COMM", title: "Audit Committee (Public)", form: "Sec 177", freq: "Quarterly", date: "Meeting", act: "Companies Act, 2013", desc: "Min 3 Directors (Majority Independent).", penalty: "Fine ₹1L-₹5L.", logic: { highValue: true, type: ["Public Limited"] } },
            { cat: "DIR_COMM", title: "Audit Committee (Listed)", form: "Reg 18", freq: "Quarterly", date: "Meeting", act: "SEBI LODR", desc: "Min 3 Directors (2/3rds Independent).", penalty: "SEBI Action.", logic: { type: ["Listed"] } },
            { cat: "DIR_COMM", title: "CSR Committee", form: "Sec 135", freq: "Annual", date: "Meeting", act: "Companies Act, 2013", desc: "Spend 2% avg profits. (Net Worth≥500Cr, T/O≥1000Cr, Profit≥5Cr).", penalty: "2x unspent amount.", logic: { type: ["Private Limited", "Public Limited", "Listed"], highProfit: true } },
            { cat: "DIR_COMM", title: "POSH Committee (ICC)", form: "POSH Act", freq: "Continuous", date: "N/A", act: "POSH Act, 2013", desc: "Internal Complaints Committee if ≥10 employees.", penalty: "₹50k fine.", logic: { type: "ALL", payroll: true } },

            // --- 2. DIRECT TAX ---
            { cat: "TAX", title: "Option: Presumptive Tax (44AD)", form: "ITR-4", freq: "Annual", date: "15th Mar", act: "Income Tax Act", desc: "Business Turnover < 2Cr. Declare 8%/6% profit. No Audit.", penalty: "Interest.", logic: { type: ["Individual", "LLP", "Partnership"], maxTurnover: 20000000, scheme: true, indivType: "Business" } },
            { cat: "TAX", title: "Option: Presumptive Prof (44ADA)", form: "ITR-4", freq: "Annual", date: "15th Mar", act: "Income Tax Act", desc: "Receipts < 75L. Declare 50% profit. No Audit.", penalty: "Interest.", logic: { type: ["Individual", "Partnership"], maxTurnover: 7500000, scheme: true, indivType: "Professional" } },

            { cat: "TAX", title: "Advance Tax Payments", form: "Challan 280", freq: "Quarterly", date: "15th Jun/Sep/Dec/Mar", act: "Income Tax Act", desc: "Pay 15/45/75/100% of estimated tax.", penalty: "Interest 1% p.m.", logic: { type: "ALL" } },
            { cat: "TAX", title: "Monthly TDS Payment", form: "Challan 281", freq: "Monthly", date: "7th of Next Month", act: "Income Tax Act", desc: "Deposit of Tax Deducted at Source.", penalty: "Interest 1.5% p.m.", logic: { type: "ALL", tds: true } },
            { cat: "TAX", title: "Monthly TCS Payment", form: "Challan 281", freq: "Monthly", date: "7th of Next Month", act: "Income Tax Act", desc: "Deposit of Tax Collected at Source.", penalty: "Interest 1.5% p.m.", logic: { type: "ALL", tds: true } },
            { cat: "TAX", title: "TDS Returns", form: "24Q/26Q", freq: "Quarterly", date: "31st Jul/Oct/Jan/May", act: "Income Tax Act", desc: "Quarterly statement of tax deducted.", penalty: "₹200/day.", logic: { type: "ALL", tds: true } },
            
            { cat: "TAX", title: "ITR Filing (Audit)", form: "ITR-3/5/6", freq: "Annual", date: "31st Oct", act: "Income Tax Act", desc: "Return for Audited Cases.", penalty: "Late fee.", logic: { type: ["Private Limited", "Public Limited", "Listed", "LLP", "Foreign Co", "Trust", "Section 8"] } },
            { cat: "TAX", title: "ITR Filing (Non-Audit)", form: "ITR-3/4/5", freq: "Annual", date: "31st July", act: "Income Tax Act", desc: "Return for Non-Audit cases.", penalty: "Late fee.", logic: { type: ["Individual", "Partnership"] } },
            { cat: "TAX", title: "Tax Audit Report", form: "3CA/3CD", freq: "Annual", date: "30th Sept", act: "Income Tax Act", desc: "Mandatory if T/O > ₹1Cr (₹10Cr Digital).", penalty: "0.5% of turnover.", logic: { minTurnover: 10000000 } },
            
            // Special Tax
            { cat: "TAX", title: "Foreign Tax Credit", form: "Form 67", freq: "Annual", date: "Prior to ITR", act: "Income Tax Act", desc: "Claim credit for taxes paid outside India.", penalty: "Credit denied.", logic: { foreign: true } },
            { cat: "TAX", title: "Opt for Lower Tax", form: "Form 10-IC", freq: "One-Time", date: "Prior to ITR", act: "Income Tax Act", desc: "Exercise option for 22% tax rate u/s 115BAA.", penalty: "Higher tax rate applies.", logic: { type: ["Private Limited", "Public Limited"], optLow: true } },
            { cat: "TAX", title: "Slump Sale Report", form: "Form 3CEA", freq: "Event", date: "30th Sept", act: "Income Tax Act", desc: "Report of CA for Slump Sale transaction.", penalty: "Disallowance.", logic: { capGains: true } },
            { cat: "TAX", title: "Rent Deduction", form: "Form 10BA", freq: "Annual", date: "With ITR", act: "Income Tax Act", desc: "Declaration for claiming deduction u/s 80GG.", penalty: "Deduction denied.", logic: { type: ["Individual"] } },
            { cat: "TAX", title: "MAT Report", form: "Form 29B", freq: "Annual", date: "30th Sept", act: "Income Tax Act", desc: "Report u/s 115JB for MAT computation.", penalty: "Defective Return.", logic: { type: ["Private Limited", "Public Limited"], optLow: false } }, 

            { cat: "TAX", title: "Form 15CA/15CB", form: "15CA/CB", freq: "Event", date: "Pre-Remittance", act: "Income Tax Act", desc: "Mandatory for foreign payments. 15CB required if taxable.", penalty: "₹1 Lakh.", logic: { foreign: true } },
            { cat: "TAX", title: "Transfer Pricing", form: "3CEB", freq: "Annual", date: "31st Oct", act: "Income Tax Act", desc: "Intl Transactions with Related Parties.", penalty: "2% of txn value.", logic: { rpt: true } },
            { cat: "TAX", title: "Startup Tax Exemption", form: "Form 10-IEF/2", freq: "One-Time/Annual", date: "Prior to ITR", act: "Income Tax Act", desc: "Claim deduction u/s 80-IAC (Eligible Startups).", penalty: "Benefit denied.", logic: { startup: true } },
            { cat: "TAX", title: "SFT Filing", form: "61A", freq: "Annual", date: "31st May", act: "Income Tax Act", desc: "High Value Txn Report.", penalty: "₹500/day.", logic: { highValue: true, type: "ALL" } },

            // --- 3. INDIRECT TAX ---
            { cat: "INDIRECT", title: "MANDATORY GST REG", form: "REG-01", freq: "One-Time", date: "Immediate", act: "GST Act", desc: "Crossed 20L/40L threshold.", penalty: "100% Tax Penalty.", logic: { gstWarn: true } }, 
            
            { cat: "INDIRECT", title: "Import Concessional", form: "IGCR-3", freq: "Monthly", date: "10th", act: "Customs IGCR", desc: "Monthly consumption statement.", penalty: "Duty Re-assessment.", logic: { mfg: true, import: true } },
            { cat: "INDIRECT", title: "Job Work Return", form: "ITC-04", freq: "Quarterly", date: "25th", act: "GST Act", desc: "Goods sent to job worker.", penalty: "Late fee.", logic: { mfg: true, gst: true } },
            { cat: "INDIRECT", title: "Option: GST Composition", form: "CMP-08", freq: "Quarterly", date: "18th", act: "GST Act", desc: "Turnover < 1.5 Cr. Reduced rate.", penalty: "Late fee.", logic: { gst: true, maxTurnover: 15000000, scheme: true } },
            { cat: "INDIRECT", title: "GSTR-1/3B (Monthly)", form: "GSTR-1/3B", freq: "Monthly", date: "11th & 20th", act: "GST Act", desc: "Turnover > ₹5 Cr. Sales & Payment.", penalty: "Late fee + Interest.", logic: { gst: true, minTurnover: 50000001 } },
            { cat: "INDIRECT", title: "GSTR-1/3B (QRMP)", form: "GSTR-1/3B", freq: "Quarterly", date: "13th & 22nd", act: "GST Act", desc: "Turnover < ₹5 Cr. Quarterly Filing.", penalty: "Late fee.", logic: { gst: true, maxTurnover: 50000000 } },
            { cat: "INDIRECT", title: "GST Annual Return", form: "GSTR-9/9C", freq: "Annual", date: "31st Dec", act: "GST Act", desc: "Consolidated Return.", penalty: "Late fee.", logic: { gst: true, minTurnover: 20000000 } },
            { cat: "INDIRECT", title: "E-Invoicing", form: "IRP Portal", freq: "Event", date: "Real-time", act: "GST Act", desc: "Generate IRN for B2B invoices (T/O > 5Cr).", penalty: "Invoice invalid.", logic: { gst: true, minTurnover: 50000000 } },
            { cat: "INDIRECT", title: "GST Refund", form: "RFD-01", freq: "Event", date: "Post Export", act: "GST Act", desc: "Claim refund of ITC.", penalty: "Loss of refund.", logic: { export: true } },
            { cat: "INDIRECT", title: "SEZ Monthly", form: "MPR", freq: "Monthly", date: "10th", act: "SEZ Rules", desc: "Monthly Performance Report.", penalty: "Fine.", logic: { export: true } },
            { cat: "INDIRECT", title: "Hazardous Waste", form: "Form 4", freq: "Annual", date: "30th June", act: "Env Prot Act", desc: "Annual Return for hazardous waste.", penalty: "Closure.", logic: { mfg: true } },

            // --- 4. COMPANIES ACT FILINGS ---
            { cat: "CORP", title: "Financials", form: "AOC-4", freq: "Annual", date: "30 days AGM", act: "Companies Act", desc: "Balance Sheet & P&L.", penalty: "₹100/day.", logic: { type: ["Private Limited", "Public Limited", "Listed", "Section 8"] } },
            { cat: "CORP", title: "Annual Return (Small)", form: "MGT-7A", freq: "Annual", date: "60 days AGM", act: "Companies Act", desc: "Small Co/OPC.", penalty: "₹100/day.", logic: { type: ["Private Limited", "OPC"], smallCo: true } },
            { cat: "CORP", title: "Annual Return", form: "MGT-7", freq: "Annual", date: "60 days AGM", act: "Companies Act", desc: "Detailed Return.", penalty: "₹100/day.", logic: { type: ["Private Limited", "Public Limited", "Listed", "Section 8"], smallCo: false } },
            { cat: "CORP", title: "Certification", form: "MGT-8", freq: "Annual", date: "With MGT-7", act: "Companies Act", desc: "PCS Certification (Paid-up ≥ 10Cr OR T/O ≥ 50Cr).", penalty: "Fine.", logic: { type: ["Public Limited", "Listed"], minTurnover: 500000000 } },
            
            { cat: "CORP", title: "MSME Return", form: "MSME-1", freq: "Half-Yearly", date: "30 Apr/Oct", act: "Companies Act", desc: "Dues > 45 days.", penalty: "₹3 Lakhs.", logic: { msme: true } },
            { cat: "CORP", title: "Return of Deposits", form: "DPT-3", freq: "Annual", date: "30th June", act: "Companies Act", desc: "Deposits & Exempted Deposits.", penalty: "Fine.", logic: { type: ["Private Limited", "Public Limited", "Listed"] } },
            { cat: "CORP", title: "Demat Audit", form: "PAS-6", freq: "Half-Yearly", date: "60 Days", act: "Companies Act", desc: "Share Capital Audit (Demat).", penalty: "Fine.", logic: { demat: true, type: ["Private Limited", "Public Limited"] } },
            { cat: "CORP", title: "CSR Registration", form: "CSR-1", freq: "One-Time", date: "Immediate", act: "Companies Act", desc: "Registration to undertake CSR.", penalty: "Funding blocked.", logic: { type: ["Trust", "Section 8"] } },
            { cat: "CORP", title: "Cost Records", form: "CRA-1", freq: "Continuous", date: "Ongoing", act: "Companies Act", desc: "Maintain Cost Records (Mfg T/O > 35Cr).", penalty: "Fine.", logic: { mfg: true, minTurnover: 350000000, type: ["Private Limited", "Public Limited"] } },

            // LLP
            { cat: "CORP", title: "LLP Statutory Audit", form: "Audit Report", freq: "Annual", date: "30th Sept", act: "LLP Act, 2008", desc: "Mandatory if Turnover > ₹40L OR Capital > ₹25L.", penalty: "Non-compliance.", logic: { type: ["LLP"], llpAudit: true } },
            { cat: "CORP", title: "Annual Return (LLP)", form: "Form 11", freq: "Annual", date: "30th May", act: "LLP Act", desc: "Statement of Partners.", penalty: "₹100/day.", logic: { type: ["LLP"] } },
            { cat: "CORP", title: "Statement of Accounts", form: "Form 8", freq: "Annual", date: "30th Oct", act: "LLP Act", desc: "Solvency.", penalty: "₹100/day.", logic: { type: ["LLP"] } },

            // --- 5. PAYROLL ---
            { cat: "LABOUR", title: "PF/ESI Payment", form: "Challan", freq: "Monthly", date: "15th", act: "EPF/ESI Act", desc: "Contribution payment.", penalty: "Damages.", logic: { payroll: true } },
            { cat: "LABOUR", title: "Professional Tax", form: "PT", freq: "Monthly", date: "State Specific", act: "State Act", desc: "Employee Tax.", penalty: "Interest.", logic: { payroll: true } },
            
            // --- 6. FEMA & OTHERS ---
            { cat: "FEMA", title: "FLA Return", form: "FLA", freq: "Annual", date: "15th July", act: "FEMA", desc: "Foreign Liabilities & Assets.", penalty: "3x Amount.", logic: { foreign: true, type: ["Private Limited", "Public Limited", "LLP", "Listed"] } },
            { cat: "FEMA", title: "ECB Return", form: "ECB-2", freq: "Monthly", date: "7th", act: "FEMA", desc: "External Commercial Borrowings.", penalty: "Penalty.", logic: { foreign: true, highDebt: true } },
            { cat: "FEMA", title: "FIU-IND Reg", form: "Registration", freq: "One-Time", date: "Immediate", act: "PMLA", desc: "Reporting Entity Registration.", penalty: "Action.", logic: { nbfc: true } },
            
            { cat: "SEBI", title: "Quarterly Results", form: "Reg 33", freq: "Quarterly", date: "45 Days", act: "SEBI LODR", desc: "Financials.", penalty: "Suspension.", logic: { type: ["Listed"] } },
            { cat: "SEBI", title: "Trading Window", form: "Closure", freq: "Quarterly", date: "Qtr End", act: "SEBI PIT", desc: "Intimation.", penalty: "Fine.", logic: { type: ["Listed"] } },
            
            { cat: "CORP", title: "Trust Renewal", form: "10A/10AB", freq: "5 Years", date: "Variable", act: "Income Tax", desc: "Renewal of 12A/80G Registration.", penalty: "Exemption Lost.", logic: { type: ["Trust", "Section 8"] } }
        ];

        // SAFE HELPERS
        const safeCheck = (id) => document.getElementById(id) ? document.getElementById(id).checked : false;
        const safeValue = (id) => document.getElementById(id) ? document.getElementById(id).value : "";
        let complianceChart = null;

        // --- NEW: Local Storage Key ---
        const STORAGE_KEY = 'ITS_ComplianceMaster_v2_State';

        window.app = {
            activeCat: 'DASHBOARD',
            hasRun: false, // NEW FLAG TO TRACK INITIAL STATE
            
            // --- NEW: Load/Save Logic ---
            saveState() {
                const state = {
                    entityType: safeValue('entityType'),
                    indivType: safeValue('indivType'),
                    industry: safeValue('industry'),
                    stateReg: safeValue('stateReg'),
                    turnover: safeValue('turnover'),
                    capital: safeValue('capital'),
                    // Toggles
                    hasGST: safeCheck('hasGST'),
                    hasTAN: safeCheck('hasTAN'),
                    hasPayroll: safeCheck('hasPayroll'),
                    isStartup: safeCheck('isStartup'),
                    hasMSME: safeCheck('hasMSME'),
                    isExport: safeCheck('isExport'),
                    hasImport: safeCheck('hasImport'),
                    hasFDI: safeCheck('hasFDI'),
                    hasRPT: safeCheck('hasRPT'),
                    isMfg: safeCheck('isMfg'),
                    isNewInc: safeCheck('isNewInc'),
                    highProfit: safeCheck('highProfit'),
                    highDebt: safeCheck('highDebt'),
                    isDirector: safeCheck('isDirector'),
                    optLowTax: safeCheck('optLowTax'),
                    hasCapGains: safeCheck('hasCapGains'),
                    hasDemat: safeCheck('hasDemat'),
                    hasCLRA: safeCheck('hasCLRA')
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            },

            loadState() {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    try {
                        const state = JSON.parse(saved);
                        // Helper to set value
                        const setVal = (id, val) => { if(document.getElementById(id)) document.getElementById(id).value = val; };
                        const setCheck = (id, val) => { if(document.getElementById(id)) document.getElementById(id).checked = val; };

                        setVal('entityType', state.entityType);
                        setVal('indivType', state.indivType);
                        setVal('industry', state.industry);
                        setVal('stateReg', state.stateReg);
                        setVal('turnover', state.turnover);
                        setVal('capital', state.capital);

                        setCheck('hasGST', state.hasGST);
                        setCheck('hasTAN', state.hasTAN);
                        setCheck('hasPayroll', state.hasPayroll);
                        setCheck('isStartup', state.isStartup);
                        setCheck('hasMSME', state.hasMSME);
                        setCheck('isExport', state.isExport);
                        setCheck('hasImport', state.hasImport);
                        setCheck('hasFDI', state.hasFDI);
                        setCheck('hasRPT', state.hasRPT);
                        setCheck('isMfg', state.isMfg);
                        setCheck('isNewInc', state.isNewInc);
                        setCheck('highProfit', state.highProfit);
                        setCheck('highDebt', state.highDebt);
                        setCheck('isDirector', state.isDirector);
                        setCheck('optLowTax', state.optLowTax);
                        setCheck('hasCapGains', state.hasCapGains);
                        setCheck('hasDemat', state.hasDemat);
                        setCheck('hasCLRA', state.hasCLRA);
                    } catch(e) {
                        console.error("Failed to load state", e);
                    }
                }
            },

            resetAll() {
                if(confirm('Reset all filters to default?')) {
                    localStorage.removeItem(STORAGE_KEY);
                    window.location.reload();
                }
            },

            downloadCSV() {
                const data = this.getFilteredData();
                if(!data || data.length === 0) {
                    alert('No data to export!');
                    return;
                }
                
                // Define headers
                const headers = ["Category", "Requirement", "Form/Ref", "Frequency", "Due Date", "Act", "Description", "Penalty"];
                
                // Convert data to CSV format
                const csvRows = [];
                csvRows.push(headers.join(','));
                
                data.forEach(row => {
                    // Escape quotes and handle commas inside fields
                    const escape = (str) => `"${(str || '').replace(/"/g, '""')}"`;
                    
                    const values = [
                        escape(row.cat),
                        escape(row.title),
                        escape(row.form),
                        escape(row.freq),
                        escape(row.date),
                        escape(row.act),
                        escape(row.desc),
                        escape(row.penalty)
                    ];
                    csvRows.push(values.join(','));
                });
                
                // Create download link
                const csvString = csvRows.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                const entity = safeValue('entityType').replace(/\s+/g, '_');
                a.setAttribute('download', `Compliance_Checklist_${entity}_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            },
            
            getFilteredData() {
                try {
                    const type = safeValue('entityType');
                    const turnover = parseInt(safeValue('turnover') || "0");
                    const capital = parseInt(safeValue('capital') || "0");
                    const indivType = safeValue('indivType');
                    const industry = safeValue('industry');
                    
                    const hasGST = safeCheck('hasGST');
                    const hasTAN = safeCheck('hasTAN');
                    const hasPayroll = safeCheck('hasPayroll');
                    const hasRPT = safeCheck('hasRPT');
                    const hasFDI = safeCheck('hasFDI');
                    const isExport = safeCheck('isExport');
                    const isMfg = safeCheck('isMfg'); 
                    const hasImport = safeCheck('hasImport');
                    const highProfit = safeCheck('highProfit');
                    const highDebt = safeCheck('highDebt');
                    const isStartup = safeCheck('isStartup');
                    const hasMSME = safeCheck('hasMSME');
                    const isDirector = safeCheck('isDirector');
                    const isNewInc = safeCheck('isNewInc');
                    const hasCapGains = safeCheck('hasCapGains');
                    const optLowTax = safeCheck('optLowTax');
                    const isNBFC = (industry === 'NBFC');
                    const hasDemat = safeCheck('hasDemat');
                    const hasCLRA = safeCheck('hasCLRA');
                    
                    // Fixed Real Estate Check
                    const isRealEstate = (industry === 'Real Estate');
                    
                    const searchInput = document.getElementById('searchInput');
                    const search = searchInput ? searchInput.value.toLowerCase() : "";
                    const isSmallCompany = (type === 'Private Limited' || type === 'OPC') && capital <= 40000000 && turnover <= 400000000;

                    return complianceData.filter(item => {
                        // Global Filters
                        if (search && !item.title.toLowerCase().includes(search) && !item.act.toLowerCase().includes(search) && !item.form.toLowerCase().includes(search)) return false;

                        const l = item.logic;
                        if (!l) return true;

                        // GST Warning Logic
                        if (l.gstWarn) {
                            if (!hasGST && (turnover > 2000000 && indivType === "Professional")) return true;
                            if (!hasGST && (turnover > 4000000 && indivType === "Business")) return true;
                            return false;
                        }

                        // Type Check
                        if (l.type && l.type !== "ALL") {
                            if (Array.isArray(l.type)) { if (!l.type.includes(type)) return false; } 
                            else if (l.type !== type) return false;
                        }

                        // MGT-7/7A
                        if (l.smallCo === true && !isSmallCompany) return false;
                        if (l.smallCo === false && isSmallCompany) return false;

                        // Toggles
                        if (l.gst && !hasGST) return false;
                        if (l.payroll && !hasPayroll) return false;
                        if (l.rpt && !hasRPT) return false;
                        if (l.foreign && !hasFDI) return false; 
                        if (l.fdi && !hasFDI) return false;
                        if (l.export && !isExport) return false;
                        if (l.import && !hasImport) return false;
                        if (l.mfg && !isMfg && industry !== "Manufacturing") return false;
                        if (l.startup && !isStartup) return false;
                        if (l.msme && !hasMSME) return false;
                        if (l.director && !isDirector) return false;
                        if (l.newInc && !isNewInc) return false;
                        if (l.nbfc && !isNBFC) return false;
                        if (l.capGains && !hasCapGains) return false;
                        if (l.demat && !hasDemat) return false;
                        if (l.clra && !hasCLRA) return false;
                        if (l.highProfit && !highProfit) return false; 
                        if (l.highDebt && !highDebt) return false;
                        if (l.highValue && !highDebt && turnover < 1000000000) return false;
                        if (l.optLow === true && !optLowTax) return false;
                        if (l.optLow === false && optLowTax) return false;
                        if (l.indivType && l.indivType !== indivType) return false;
                        if (l.llpAudit && (turnover <= 4000000 && capital <= 2500000)) return false;
                        if (l.minTurnover && turnover < l.minTurnover) return false;
                        if (l.maxTurnover && turnover > l.maxTurnover) return false;
                        if (l.minCapital && capital < l.minCapital) return false;
                        
                        // Fix for TAN
                        if (l.hasTAN && !hasTAN) return false;
                        
                        // Fix for Real Estate
                        if (l.industry && l.industry === "Real Estate" && !isRealEstate) return false;

                        return true;
                    });
                } catch (e) { return []; }
            },

            updateFields() {
                const type = safeValue('entityType');
                const capitalField = document.getElementById('capitalField');
                const indivTypeField = document.getElementById('indivTypeField');
                const directorToggle = document.getElementById('directorToggle');
                const optTaxToggle = document.getElementById('optTaxToggle');
                const capGainsToggle = document.getElementById('capGainsToggle');
                const dematToggle = document.getElementById('dematToggle');
                const labourToggle = document.getElementById('labourToggle');

                if (['Individual', 'Trust', 'LLP', 'Partnership'].includes(type)) {
                    if (capitalField) capitalField.classList.add('hidden');
                } else {
                    if (capitalField) capitalField.classList.remove('hidden');
                }

                if (type === 'Individual') {
                    if (indivTypeField) indivTypeField.classList.remove('hidden');
                    if (directorToggle) directorToggle.classList.remove('hidden');
                } else {
                    if (indivTypeField) indivTypeField.classList.add('hidden');
                    if (directorToggle) directorToggle.classList.add('hidden');
                }

                if (['Private Limited', 'Public Limited'].includes(type)) {
                    if (optTaxToggle) optTaxToggle.classList.remove('hidden');
                    if (capGainsToggle) capGainsToggle.classList.remove('hidden');
                    if (dematToggle) dematToggle.classList.remove('hidden');
                } else {
                    if (optTaxToggle) optTaxToggle.classList.add('hidden');
                    if (capGainsToggle) capGainsToggle.classList.add('hidden');
                    if (dematToggle) dematToggle.classList.add('hidden');
                }

                if (labourToggle) labourToggle.classList.remove('hidden');
            },

            manualRun() {
                this.hasRun = true; // MARK ANALYSIS AS RUN
                this.saveState(); // SAVE ON MANUAL RUN
                
                const sidebar = document.getElementById('configSidebar');
                if (sidebar && !sidebar.classList.contains('-translate-x-full')) this.toggleSidebar();
                this.render();
            },

            toggleSidebar() {
                const sidebar = document.getElementById('configSidebar');
                const backdrop = document.getElementById('drawerBackdrop'); 
                
                if (!sidebar || !backdrop) return;

                const isOpen = !sidebar.classList.contains('-translate-x-full');
                if (isOpen) {
                    sidebar.classList.add('-translate-x-full');
                    backdrop.classList.add('hidden');
                } else {
                    backdrop.classList.remove('hidden');
                    sidebar.classList.remove('-translate-x-full');
                }
            },

            // New Enquire Logic
            enquireCompliance() {
                // Link to Pricing Page
                this.closeModal();
                router('pricing');
                
                // Optional: Scroll to top of pricing or highlight a section
                // window.scrollTo(0,0);
            },
            
            // NEW: Get Pricing from modal
            getPricing() {
                this.closeModal();
                router('pricing');
            },

            updateChart(results) {
                const canvas = document.getElementById('complianceChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                const counts = {};
                results.forEach(item => {
                    const cat = item.cat;
                    counts[cat] = (counts[cat] || 0) + 1;
                });

                const labels = Object.keys(counts);
                const data = Object.values(counts);
                
                if (complianceChart) {
                    complianceChart.destroy();
                }

                // Centralized Color Mapping for consistency
                const colorMap = {
                    'TAX': '#16a34a', // green-600
                    'INDIRECT': '#ea580c', // orange-600
                    'CORP': '#7c3aed', // violet-600
                    'LABOUR': '#db2777', // pink-600
                    'DIR_COMM': '#2563eb', // blue-600
                    'FEMA': '#d946ef', // fuchsia-600
                    'SEBI': '#0891b2', // cyan-600
                    'SECTOR': '#dc2626' // red-600
                };
                
                const bgColors = labels.map(l => colorMap[l] || '#94a3b8');

                complianceChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: bgColors,
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }, // Hide default legend
                            tooltip: { enabled: true }
                        },
                        cutout: '75%'
                    }
                });
            },

            render() {
                try {
                    const fullList = this.getFilteredData();
                    const type = safeValue('entityType');

                    // --- FIX: Update Header Counts ---
                    const totalEl = document.getElementById('totalCount');
                    const riskEl = document.getElementById('highRiskCount');
                    const entityEl = document.getElementById('entityDisplay');
                    
                    if(totalEl) totalEl.innerText = fullList.length;
                    if(riskEl) {
                        const highRisk = fullList.filter(d => 
                            d.penalty.includes('Disallowance') || 
                            d.penalty.includes('Compounding') || 
                            d.penalty.includes('Suspension') ||
                            d.penalty.includes('Lakh') ||
                            d.penalty.includes('LSF') ||
                            d.penalty.includes('Action')
                        ).length;
                        riskEl.innerText = highRisk;
                    }
                    if(entityEl) entityEl.innerText = type;

                    // Calculate counts for ALL categories
                    const globalCounts = {};
                    fullList.forEach(i => globalCounts[i.cat] = (globalCounts[i.cat] || 0) + 1);

                    // 0. CHECK IF ANALYSIS HAS BEEN RUN
                    const instructionEl = document.getElementById('initialInstruction');
                    const dashboardSec = document.getElementById('dashboardSection');
                    const listFilters = document.getElementById('listFilters');
                    const listSection = document.getElementById('listSection');
                    const tabsWrapper = document.getElementById('tabsWrapper');
                    const mobileBanners = document.getElementById('mobileBannersContainer');
                    
                    if (!this.hasRun) {
                        if(instructionEl) instructionEl.classList.remove('hidden');
                        if(dashboardSec) dashboardSec.classList.add('hidden');
                        if(listFilters) listFilters.classList.add('hidden');
                        if(listSection) listSection.classList.add('hidden');
                        if(tabsWrapper) tabsWrapper.classList.add('hidden');
                        if(mobileBanners) mobileBanners.classList.add('hidden');
                        return;
                    } else {
                        if(instructionEl) instructionEl.classList.add('hidden');
                        if(tabsWrapper) tabsWrapper.classList.remove('hidden');
                        if(mobileBanners) mobileBanners.classList.remove('hidden');
                    }

                    // 1. Dashboard Logic (Only for DASHBOARD tab)
                    const grid = document.getElementById('dashboardGrid');
                    
                    if (this.activeCat === 'DASHBOARD') {
                        if(dashboardSec) dashboardSec.classList.remove('hidden');
                        if(listFilters) listFilters.classList.add('hidden');
                        if(listSection) listSection.classList.add('hidden');
                        
                        this.updateChart(fullList);

                        let html = '';
                        // Expanded Metadata for better UI
                        const cats = {
                            'TAX': { l: 'Direct Tax', c: 'text-green-600 bg-green-50', dot: 'bg-green-500' },
                            'INDIRECT': { l: 'GST & Customs', c: 'text-orange-600 bg-orange-50', dot: 'bg-orange-500' },
                            'CORP': { l: 'Corporate Law', c: 'text-violet-600 bg-violet-50', dot: 'bg-violet-500' },
                            'LABOUR': { l: 'Payroll', c: 'text-pink-600 bg-pink-50', dot: 'bg-pink-500' },
                            'DIR_COMM': { l: 'Directors', c: 'text-blue-600 bg-blue-50', dot: 'bg-blue-500' },
                            'FEMA': { l: 'FEMA', c: 'text-fuchsia-600 bg-fuchsia-50', dot: 'bg-fuchsia-500' },
                            'SEBI': { l: 'SEBI', c: 'text-cyan-600 bg-cyan-50', dot: 'bg-cyan-500' }
                        };

                        // Populate Category Grid (Big Cards)
                        Object.keys(cats).forEach(key => {
                            if (globalCounts[key]) {
                                html += `<div onclick="window.app.setCat('${key}')" class="bg-white p-4 rounded-xl border border-slate-100 shadow-card hover:shadow-card-hover transition-all cursor-pointer flex items-center justify-between group">
                                    <div>
                                        <div class="text-[10px] font-bold uppercase tracking-wider text-slate-400 mb-1">${cats[key].l}</div>
                                        <div class="text-2xl font-bold text-slate-800">${globalCounts[key]}</div>
                                    </div>
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center ${cats[key].c} group-hover:scale-110 transition-transform">
                                        <i class="ph ph-arrow-right font-bold"></i>
                                    </div>
                                </div>`;
                            }
                        });
                        if(grid) grid.innerHTML = html;

                        // Populate Chart Summary (List below chart)
                        const summaryHtml = Object.keys(globalCounts).map(k => {
                            const m = cats[k] || { l: k, dot: 'bg-slate-400' };
                            
                            return `
                            <div onclick="window.app.setCat('${k}')" class="group flex items-center justify-between p-2.5 rounded-lg hover:bg-slate-50 border border-transparent hover:border-slate-100 cursor-pointer transition-all">
                                <div class="flex items-center gap-3">
                                    <span class="w-2.5 h-2.5 rounded-full ${m.dot} shadow-sm ring-1 ring-white"></span>
                                    <span class="text-xs font-semibold text-slate-600 group-hover:text-slate-900 transition-colors">${m.l}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-bold text-slate-800 bg-slate-100 px-2 py-0.5 rounded group-hover:bg-white group-hover:shadow-sm transition-all">${globalCounts[k]}</span>
                                    <i class="ph ph-caret-right text-xs text-slate-300 group-hover:text-primary-600"></i>
                                </div>
                            </div>`;
                        }).join('');
                        
                        const summaryContainer = document.getElementById('chartSummary');
                        if(summaryContainer) {
                            // Update container class for list layout
                            summaryContainer.className = "w-full mt-6 pt-4 border-t border-slate-100 flex flex-col gap-1"; 
                            summaryContainer.innerHTML = summaryHtml;
                        }

                    } else {
                        if(dashboardSec) dashboardSec.classList.add('hidden');
                        if(listFilters) listFilters.classList.remove('hidden');
                        if(listSection) listSection.classList.remove('hidden');
                    }

                    // 2. Tab Generation
                    const allTabs = [
                         {k:'DASHBOARD', n:'Dashboard'},
                         {k:'ALL', n:'All List'}, 
                         {k:'DIR_COMM', n:'Directors'}, 
                         {k:'TAX', n:'Direct Tax'}, 
                         {k:'INDIRECT', n:'GST & Customs'}, 
                         {k:'CORP', n:'Corporate Law'}, 
                         {k:'LABOUR', n:'Payroll'}, 
                         {k:'SEBI', n:'SEBI'}, 
                         {k:'FEMA', n:'FEMA'}
                    ];

                    const tabsWithData = allTabs.filter(t => t.k === 'DASHBOARD' || t.k === 'ALL' || globalCounts[t.k] > 0);
                    const tabsWithoutData = allTabs.filter(t => t.k !== 'DASHBOARD' && t.k !== 'ALL' && !globalCounts[t.k]);
                    
                    const dataTabs = tabsWithData.filter(t => t.k !== 'DASHBOARD' && t.k !== 'ALL');
                    if (type === 'Individual' || type === 'LLP' || type === 'Partnership') {
                         const priority = { 'TAX': 1, 'INDIRECT': 2, 'LABOUR': 3 };
                         dataTabs.sort((a, b) => (priority[a.k] || 99) - (priority[b.k] || 99));
                    } else {
                         const priority = { 'CORP': 1, 'TAX': 2, 'INDIRECT': 3 };
                         dataTabs.sort((a, b) => (priority[a.k] || 99) - (priority[b.k] || 99));
                    }

                    const finalTabs = [{k:'DASHBOARD', n:'Dashboard'}, {k:'ALL', n:'All List'}, ...dataTabs, ...tabsWithoutData];

                    const tabsContainer = document.getElementById('tabsContainer');
                    if(tabsContainer) {
                        tabsContainer.innerHTML = finalTabs.map(t => {
                            const count = (t.k === 'ALL' || t.k === 'DASHBOARD') ? fullList.length : (globalCounts[t.k] || 0);
                            const isActive = this.activeCat === t.k;
                            const hasData = count > 0;
                            
                            let baseClass = "whitespace-nowrap px-4 py-3.5 border-b-2 text-sm font-medium transition-all duration-200 flex items-center gap-2";
                            let colorClass = "";

                            if (isActive) {
                                colorClass = "border-brand-600 text-brand-700 bg-brand-50/60";
                            } else if (hasData) {
                                colorClass = "border-transparent text-slate-700 hover:text-brand-600 hover:bg-slate-50"; 
                            } else {
                                colorClass = "border-transparent text-slate-400 opacity-60 hover:text-slate-500"; 
                            }

                            const badgeColor = isActive ? 'bg-brand-200 text-brand-800' : 'bg-slate-200 text-slate-600';
                            const badge = (t.k !== 'DASHBOARD' && hasData) ? `<span class="text-[10px] px-1.5 py-0.5 rounded-full ${badgeColor}">${count}</span>` : '';

                            return `<button onclick="window.app.setCat('${t.k}')" class="${baseClass} ${colorClass}">
                                ${t.n} ${badge}
                            </button>`;
                        }).join('');
                    }

                    // 3. Render List (Only if not Dashboard)
                    if (this.activeCat !== 'DASHBOARD') {
                        const displayList = this.activeCat === 'ALL' ? fullList : fullList.filter(i => i.cat === this.activeCat);
                        const container = document.getElementById('complianceBody');
                        
                        const resCount = document.getElementById('resultsCount');
                        if(resCount) resCount.innerText = `${displayList.length} Found`;
                        
                        if (displayList.length === 0) {
                            if(document.getElementById('emptyState')) document.getElementById('emptyState').classList.remove('hidden');
                            if(container) container.innerHTML = '';
                            if(document.getElementById('banners')) document.getElementById('banners').innerHTML = '';
                        } else {
                            if(document.getElementById('emptyState')) document.getElementById('emptyState').classList.add('hidden');
                            
                            // Banners
                            let banners = '';
                            const turnover = parseInt(safeValue('turnover') || "0");
                            const hasGST = safeCheck('hasGST');
                            const isExport = safeCheck('isExport');
                            
                            if (['Individual', 'LLP'].includes(type) && turnover < 20000000) banners += `<div class="bg-opt-50 text-opt-700 p-3 rounded-lg text-xs font-medium border border-opt-200 mb-2 shadow-sm">💡 Tip: You may be eligible for Presumptive Taxation (Sec 44AD/ADA) - No Audit Required.</div>`;
                            if (isExport) banners += `<div class="bg-blue-50 text-blue-800 p-3 rounded-lg text-xs font-medium border border-blue-100 mb-2 shadow-sm">🌍 Export Biz: Ensure LUT is filed annually to export without IGST payment.</div>`;

                            if(document.getElementById('banners')) document.getElementById('banners').innerHTML = banners;
                            const mobileBanners = document.getElementById('mobileBanners');
                            if(mobileBanners && window.innerWidth < 1024) {
                                mobileBanners.innerHTML = banners;
                            }

                            if(container) {
                                container.innerHTML = displayList.map((item, i) => {
                                    let badge = "bg-gray-100 text-gray-600";
                                    if(item.cat === "TAX") badge = "bg-tax-50 text-tax-700 border border-tax-100";
                                    if(item.cat === "CORP") badge = "bg-corp-50 text-corp-700 border border-corp-100";
                                    if(item.cat === "INDIRECT") badge = "bg-indirect-50 text-indirect-700 border border-indirect-100";
                                    if(item.cat === "LABOUR") badge = "bg-labour-50 text-labour-700 border border-labour-100";
                                    if(item.cat === "DIR_COMM") badge = "bg-brand-50 text-brand-700 border border-brand-100";
                                    if(item.cat === "FEMA") badge = "bg-fema-50 text-fema-700";
                                    if(item.logic.scheme) badge = "bg-opt-50 text-opt-700 border border-opt-200";
                                    if(item.logic.gstWarn) badge = "bg-warn-50 text-warn-700 border border-warn-200";

                                    return `<div onclick="window.app.openModal(${complianceData.indexOf(item)})" class="print-break group cursor-pointer p-4 sm:px-6 sm:py-3.5 bg-white hover:bg-slate-50 transition-all border-b border-slate-50 last:border-0 hover:shadow-md rounded-lg mx-2 my-1" style="animation: fadeIn 0.3s ease-out forwards; animation-delay: ${Math.min(i * 30, 300)}ms; opacity: 0">
                                        <div class="sm:grid sm:grid-cols-12 gap-4 items-center">
                                            <div class="sm:col-span-5 mb-2 sm:mb-0">
                                                <div class="flex justify-between items-start">
                                                    <div>
                                                        <h3 class="text-sm font-semibold text-slate-800 group-hover:text-brand-700 transition-colors">${item.title}</h3>
                                                        <span class="mt-1.5 inline-block px-2 py-0.5 rounded text-[10px] font-bold tracking-wide uppercase ${badge}">${item.cat.replace('_', ' & ')}</span>
                                                    </div>
                                                    <div class="sm:hidden text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded">${item.date}</div>
                                                </div>
                                            </div>
                                            <div class="sm:col-span-2 text-xs text-slate-500 font-mono mb-1 sm:mb-0 bg-slate-50 inline-block px-2 py-1 rounded border border-slate-100 text-center w-fit sm:w-auto">
                                                ${item.form}
                                            </div>
                                            <div class="sm:col-span-2 mb-2 sm:mb-0">
                                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium text-slate-600">
                                                    ${item.freq}
                                                </span>
                                            </div>
                                            <div class="sm:col-span-3 text-sm text-slate-600 sm:border-l-2 sm:border-slate-100 sm:pl-4 flex justify-between items-center">
                                                <div class="hidden sm:block text-xs font-bold text-slate-700 group-hover:text-brand-600">${item.date}</div>
                                                <i class="fa-solid fa-chevron-right text-xs text-slate-300 group-hover:text-brand-400 transform group-hover:translate-x-1 transition-all no-print"></i>
                                            </div>
                                        </div>
                                    </div>`;
                                }).join('');
                            }
                        }
                    }

                    // Update Print Meta
                    if(document.getElementById('printDate')) document.getElementById('printDate').innerText = new Date().toLocaleDateString();
                    if(document.getElementById('printEntity')) document.getElementById('printEntity').innerText = type.toUpperCase();

                } catch (e) { console.error("Render error", e); }
            },

            setCat(c) { this.activeCat = c; this.render(); },
            
            openModal(index) {
                // FIXED: Direct lookup from the main complianceData array using the index passed from renderList
                const item = complianceData[index];
                
                if(!item) {
                    console.error("Compliance item not found for index:", index);
                    return;
                }

                document.getElementById('modalTitle').innerText = item.title;
                document.getElementById('modalAct').innerText = item.act;
                document.getElementById('modalForm').innerText = item.form;
                document.getElementById('modalDesc').innerText = item.desc;
                document.getElementById('modalDate').innerText = item.date;
                document.getElementById('modalFreq').innerText = item.freq;
                document.getElementById('modalPenalty').innerText = item.penalty;
                
                const modal = document.getElementById('infoModal');
                const content = document.getElementById('modalContent');
                
                modal.classList.remove('hidden');
                
                // Reset animation classes
                content.classList.remove('scale-100', 'opacity-100');
                content.classList.add('scale-95', 'opacity-0');
                
                // Trigger animation
                setTimeout(() => { 
                    content.classList.remove('scale-95', 'opacity-0'); 
                    content.classList.add('scale-100', 'opacity-100'); 
                }, 10);
            },

            closeModal() {
                const modal = document.getElementById('infoModal');
                const content = document.getElementById('modalContent');
                
                content.classList.remove('scale-100', 'opacity-100');
                content.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => { 
                    modal.classList.add('hidden'); 
                    // Clean up classes for next open
                    content.classList.remove('scale-95', 'opacity-0');
                }, 200);
            },

            // NEW: Get Pricing from modal
            getPricing() {
                this.closeModal();
                router('pricing');
            }
        };

        // --- ENQUIRY MODAL LOGIC (Restored) ---
        function openEnquiryModal(serviceName) {
            const nameEl = document.getElementById('enquiryServiceName');
            const linkEl = document.getElementById('enquiryMailLink');
            const modal = document.getElementById('enquiryModal');

            if(nameEl) nameEl.innerText = serviceName;
            
            const email = "instanttaxsolutionsindia@gmail.com";
            const subject = encodeURIComponent("Enquiry: " + serviceName);
            
            if(linkEl) linkEl.href = `mailto:${email}?subject=${subject}`;
            
            if(modal) {
                modal.classList.remove('hidden');
                const inner = modal.querySelector('div > div');
                if(inner) {
                    inner.classList.add('modal-enter');
                    setTimeout(() => inner.classList.add('modal-enter-active'), 10);
                }
            }
        }

        function closeEnquiryModal() {
            const modal = document.getElementById('enquiryModal');
            if(modal) {
                const inner = modal.querySelector('div > div');
                if(inner) {
                    inner.classList.remove('modal-enter-active');
                    inner.classList.add('modal-exit-active');
                }
                setTimeout(() => { 
                    modal.classList.add('hidden'); 
                    if(inner) inner.classList.remove('modal-exit-active'); 
                }, 200);
            }
        }

        // --- SCROLL EFFECT LOGIC (Restored) ---
        function handleLogoScroll(e) {
            const logo = document.getElementById('brand-logo');
            const vision = document.getElementById('brand-vision');
            
            // Get current scroll position of the active view
            const scrollPosition = e.target.scrollTop;
            
            // THRESHOLD: 50px
            if (scrollPosition > 50) {
                // HIDE LOGO (Fade out & move up)
                if(logo) {
                    logo.classList.remove('opacity-100', 'translate-y-0');
                    logo.classList.add('opacity-0', '-translate-y-4'); 
                }
                
                // SHOW VISION (Fade in & move to center)
                if(vision) {
                    vision.classList.remove('opacity-0', 'translate-y-4'); 
                    vision.classList.add('opacity-100', 'translate-y-0');
                }
            } else {
                // SHOW LOGO (Fade in & move to center)
                if(logo) {
                    logo.classList.add('opacity-100', 'translate-y-0');
                    logo.classList.remove('opacity-0', '-translate-y-4');
                }
                
                // HIDE VISION (Fade out & move down)
                if(vision) {
                    vision.classList.add('opacity-0', 'translate-y-4');
                    vision.classList.remove('opacity-100', 'translate-y-0');
                }
            }
        }

        // Attach listeners to all scrollable views once DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // IDs of the sections that scroll independently
            const views = ['view-home', 'view-checklist', 'view-pricing', 'dashboardSection', 'listSection'];
            views.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('scroll', handleLogoScroll);
            });
            
             // Initialize App if on checklist view or just load state to be ready
            if(window.app) {
                window.app.loadState();
                window.app.updateFields();
                // Check if already run, if so render results, else show instruction
                if(window.app.hasRun) {
                    window.app.render();
                }
            }
        });
    </script>
</body>
</html>