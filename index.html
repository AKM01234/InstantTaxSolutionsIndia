<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Instant Tax Solutions India - Compliance & Advisory</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
                        slate: { 850: '#1e293b', 900: '#0f172a' },
                        tax: { 50: '#f0fdf4', 100: '#dcfce7', 700: '#15803d' },
                        corp: { 50: '#f5f3ff', 100: '#ede9fe', 700: '#6d28d9' },
                        indirect: { 50: '#fff7ed', 100: '#ffedd5', 700: '#c2410c' },
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    },
                    animation: { 'fade-in': 'fadeIn 0.3s ease-out forwards' },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .hidden-section { display: none !important; }
        .custom-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.3); }
        .portal-sidebar { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        .portal-sidebar.active { transform: translateX(0); }
        .portal-page { display: none !important; padding-bottom: 80px; animation: fadeIn 0.3s ease-out; }
        .portal-page.active { display: block !important; }
        #portal-login.active { display: flex !important; } 
        .progress-ring__circle { transition: stroke-dashoffset 0.5s ease-in-out; transform: rotate(-90deg); transform-origin: 50% 50%; }
        @keyframes floatUp { 0% { top: 110%; opacity: 0; transform: rotate(0deg); } 10% { opacity: 0.15; } 100% { top: -10%; opacity: 0; transform: rotate(10deg); } }
        .float-item { position: absolute; color: rgba(255,255,255,0.1); font-weight: 800; user-select: none; pointer-events: none; z-index: 1; animation: floatUp linear infinite; }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-slate-50 text-gray-800 overflow-hidden">

<div id="marketing-site" class="flex flex-col h-screen overflow-hidden">
    <nav class="bg-white/90 backdrop-blur border-b border-gray-200 sticky top-0 z-40 shadow-sm flex-none h-16" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex justify-between items-center">
            <div class="font-black text-xl text-slate-900 cursor-pointer" onclick="router('home')">Instant Tax</div>
            <div class="hidden md:flex items-center space-x-8">
                <button onclick="router('home')" class="text-sm font-semibold">Home</button>
                <button onclick="router('checklist')" class="text-sm font-semibold">Checklist</button>
                <button onclick="startPortal()" class="text-brand-700 font-bold flex items-center gap-2"><i class="ph ph-lock"></i> Client Portal</button>
            </div>
        </div>
    </nav>

    <div id="view-home" class="view-section h-[calc(100vh-64px)] overflow-y-auto custom-scroll p-8">
        <div class="max-w-4xl mx-auto text-center py-20">
            <h1 class="text-5xl font-black mb-6">Simplified Tax Compliance</h1>
            <p class="text-xl text-slate-500 mb-12">Automated tools for Indian Businesses and Professionals.</p>
            
            <!-- Smart Home Widget -->
            <div class="bg-white p-8 rounded-3xl border-2 border-brand-100 shadow-xl text-left max-w-2xl mx-auto">
                <h3 class="font-bold text-xl mb-4">Quick Compliance Check</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <select id="homeEntityType" class="rounded-xl border-slate-200">
                        <option value="Private Limited">Private Limited</option>
                        <option value="LLP">LLP</option>
                        <option value="Individual">Individual</option>
                    </select>
                    <select id="homeTurnover" class="rounded-xl border-slate-200">
                        <option value="1500000">&lt; 20 Lakhs</option>
                        <option value="50000000">1.5 Cr - 10 Cr</option>
                        <option value="2000000000">&gt; 10 Cr</option>
                    </select>
                </div>
                <button onclick="startChecklistFromHome()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold">Generate Checklist</button>
            </div>
        </div>
    </div>

    <div id="view-checklist" class="view-section hidden-section h-[calc(100vh-64px)] flex bg-white">
        <aside class="w-80 border-r p-6 space-y-6">
            <h2 class="font-bold uppercase text-xs text-slate-400">Settings</h2>
            <select id="entityType" class="w-full rounded-lg border-slate-200"><option value="Private Limited">Private Limited</option></select>
            <select id="turnover" class="w-full rounded-lg border-slate-200"><option value="1500000">< 20L</option></select>
            <button onclick="window.app.manualRun()" class="w-full bg-brand-600 text-white py-3 rounded-xl font-bold">Analyze</button>
        </aside>
        <main class="flex-1 p-10 overflow-y-auto" id="complianceBody">
            <div id="initialInstruction" class="text-slate-400">Please run analysis.</div>
        </main>
    </div>
</div>

<!-- CLIENT PORTAL CONTAINER -->
<div id="client-portal" class="hidden fixed inset-0 z-50 bg-slate-50 flex-col h-full overflow-hidden">
    <div id="app-sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="portalUI.closeSidebar()"></div>
    <aside id="app-sidebar" class="fixed top-0 left-0 h-full w-72 bg-white z-50 shadow-2xl flex flex-col portal-sidebar">
        <div class="p-6 bg-slate-900 text-white">
            <div id="sidebarUserInitials" class="w-12 h-12 rounded-full bg-brand-600 flex items-center justify-center font-bold text-lg mb-3">?</div>
            <h3 id="sidebarUserName" class="font-bold text-sm truncate">User</h3>
            <p id="sidebarUserEmail" class="text-[10px] text-slate-400 truncate">email@example.com</p>
            <div id="connectionStatus" class="hidden mt-2 inline-flex items-center px-2 py-0.5 rounded-full text-[9px] font-medium bg-red-100 text-red-800">
                <span class="w-1.5 h-1.5 bg-red-500 rounded-full mr-1.5"></span> Offline Mode
            </div>
        </div>
        <nav class="flex-1 py-4 space-y-1">
            <button onclick="portalApp.nav('dashboard')" class="w-full text-left px-6 py-3 hover:bg-brand-50 flex items-center gap-3"><i class="ph ph-squares-four"></i> Dashboard</button>
            <button onclick="portalApp.nav('profile')" class="w-full text-left px-6 py-3 hover:bg-brand-50 flex items-center gap-3"><i class="ph ph-user-gear"></i> Profile</button>
            <button onclick="exitPortal()" class="w-full text-left px-6 py-3 text-red-500 flex items-center gap-3 border-t mt-4"><i class="ph ph-sign-out"></i> Logout</button>
        </nav>
    </aside>

    <header class="bg-white border-b h-16 flex items-center justify-between px-4 shrink-0">
        <button onclick="portalUI.openSidebar()" class="p-2 text-2xl text-slate-600"><i class="ph ph-list"></i></button>
        <h1 id="app-header-title" class="font-bold text-slate-800 uppercase tracking-wider">DASHBOARD</h1>
        <div class="w-10"></div>
    </header>

    <main class="flex-1 overflow-y-auto p-6" id="app-main">
        <!-- LOGIN SECTION -->
        <div id="portal-login" class="fixed inset-0 z-[60] flex items-center justify-center bg-slate-900 p-6 portal-page active">
            <div class="w-full max-w-sm bg-white rounded-3xl p-8 shadow-2xl">
                <h1 class="text-2xl font-bold text-center mb-8" id="authTitle">Secure Access</h1>
                <div class="space-y-4">
                    <input id="emailInput" type="email" placeholder="Email" class="w-full rounded-xl border-slate-200 py-3">
                    <input id="passInput" type="password" placeholder="Password" class="w-full rounded-xl border-slate-200 py-3">
                    <button onclick="portalApp.handleEmailAuth()" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold">Continue</button>
                    <div class="relative py-2 flex items-center"><div class="flex-grow border-t"></div><span class="px-4 text-xs text-slate-400">OR</span><div class="flex-grow border-t"></div></div>
                    <button onclick="portalApp.loginGoogle()" class="w-full border py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-50 transition"><img src="https://www.svgrepo.com/show/355037/google.svg" class="w-4 h-4"> Google Login</button>
                    <p class="text-center text-xs text-slate-500 mt-4">Demo? client@example.com / password</p>
                </div>
            </div>
        </div>
        
        <!-- DASHBOARD PAGE -->
        <div id="portal-dashboard" class="portal-page space-y-6">
            <h1 id="dashboardUserName" class="text-2xl font-black">Welcome</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl border shadow-sm">
                    <h3 class="text-xs font-bold text-slate-400 uppercase">Compliance Health</h3>
                    <div class="text-4xl font-black text-brand-600 mt-2" id="healthText">0%</div>
                    <div class="w-full h-2 bg-slate-100 rounded-full mt-4 overflow-hidden"><div id="healthBar" class="h-full bg-brand-600" style="width: 0%"></div></div>
                </div>
                <div class="bg-white p-6 rounded-2xl border shadow-sm">
                    <h3 class="text-xs font-bold text-slate-400 uppercase">Estimated Tax Paid</h3>
                    <div class="text-4xl font-black text-slate-900 mt-2" id="finTotalPaid">₹ 0</div>
                </div>
            </div>
        </div>

        <!-- PROFILE PAGE -->
        <div id="portal-profile" class="portal-page">
            <div class="bg-white p-8 rounded-2xl border shadow-sm space-y-6 max-w-xl mx-auto">
                <h3 class="font-bold text-xl">Cloud Profile Sync</h3>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Entity Structure</label>
                    <select id="profType" class="w-full rounded-lg border-slate-200">
                        <option value="Private Limited">Private Limited</option>
                        <option value="LLP">LLP</option>
                        <option value="Individual">Individual</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Annual Revenue</label>
                    <select id="profTurnover" class="w-full rounded-lg border-slate-200">
                        <option value="1500000">< 20L</option>
                        <option value="50000000">1.5Cr - 10Cr</option>
                        <option value="150000000">> 10Cr</option>
                    </select>
                </div>
                <button onclick="portalApp.saveProfile()" class="w-full bg-brand-600 text-white py-4 rounded-xl font-bold">Update Backend</button>
            </div>
        </div>
    </main>
</div>

<script>
    // --- 1. GLOBAL NAVIGATION ---
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'its-tax-india';

    function router(view) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden-section'));
        const v = document.getElementById(`view-${view}`);
        if(v) v.classList.remove('hidden-section');
        window.scrollTo(0,0);
    }

    function startPortal() {
        document.getElementById('marketing-site').classList.add('hidden');
        document.getElementById('client-portal').classList.remove('hidden');
        document.getElementById('client-portal').classList.add('flex');
    }

    function exitPortal() {
        document.getElementById('client-portal').classList.add('hidden');
        document.getElementById('marketing-site').classList.remove('hidden');
        router('home');
    }

    function startChecklistFromHome() {
        const type = document.getElementById('homeEntityType').value;
        const to = document.getElementById('homeTurnover').value;
        router('checklist');
        setTimeout(() => {
            document.getElementById('entityType').value = type;
            document.getElementById('turnover').value = to;
            window.app.manualRun();
        }, 100);
    }

    // --- 2. FIREBASE & BACKEND LOGIC ---
    const portalApp = {
        currentUser: null,
        isOffline: false,
        profile: { type: "Private Limited", turnover: 150000000, gst: true, payroll: false },

        // --- RULE 1 & 3 COMPLIANCE ---
        async handleUserLogin(user) {
            this.currentUser = user;
            const displayName = user.displayName || user.email.split('@')[0];
            
            // Update UI
            document.getElementById('sidebarUserName').innerText = displayName;
            document.getElementById('sidebarUserEmail').innerText = user.email;
            document.getElementById('dashboardUserName').innerText = "Hello, " + displayName;
            document.getElementById('sidebarUserInitials').innerText = displayName[0].toUpperCase();

            // Try loading from Firestore (Path follows RULE 1)
            let loaded = false;
            if (typeof firebase !== 'undefined' && !this.isOffline) {
                try {
                    const db = firebase.firestore();
                    // User-specific private path: /artifacts/{appId}/users/{userId}/data/profile
                    const docRef = db.doc(`artifacts/${appId}/users/${user.uid}/data/profile`);
                    const doc = await docRef.get();
                    
                    if (doc.exists) {
                        this.profile = doc.data();
                        loaded = true;
                    } else {
                        // Create default on first login
                        await docRef.set(this.profile);
                        loaded = true;
                    }
                } catch (e) {
                    console.warn("Backend connection issue, falling back to local.");
                    this.isOffline = true;
                    document.getElementById('connectionStatus').classList.remove('hidden');
                }
            }

            // Local Fallback
            if(!loaded) {
                const local = localStorage.getItem('its_profile_' + user.uid);
                if(local) this.profile = JSON.parse(local);
            }

            this.login();
        },

        login() {
            document.getElementById('portal-login').classList.remove('active');
            this.updateDashboardStats();
            this.nav('dashboard');
        },

        nav(id) {
            document.querySelectorAll('.portal-page').forEach(el => el.classList.remove('active'));
            const target = document.getElementById(`portal-${id}`);
            if(target) target.classList.add('active');
            document.getElementById('app-header-title').innerText = id.toUpperCase();
            portalUI.closeSidebar();
            
            if(id === 'profile') {
                document.getElementById('profType').value = this.profile.type;
                document.getElementById('profTurnover').value = this.profile.turnover;
            }
        },

        async saveProfile() {
            this.profile.type = document.getElementById('profType').value;
            this.profile.turnover = parseInt(document.getElementById('profTurnover').value);
            
            // Save locally
            if(this.currentUser) localStorage.setItem('its_profile_' + this.currentUser.uid, JSON.stringify(this.profile));

            // Save to Cloud (Strict Path)
            if(this.currentUser && !this.isOffline) {
                try {
                    await firebase.firestore().doc(`artifacts/${appId}/users/${this.currentUser.uid}/data/profile`).set(this.profile);
                    alert("Cloud Sync Successful!");
                } catch (e) {
                    alert("Saved Locally (Cloud sync error)");
                }
            } else {
                alert("Saved Locally");
            }
            this.updateDashboardStats();
            this.nav('dashboard');
        },

        handleEmailAuth() {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            if(!email || !pass) return;
            
            if(typeof firebase !== 'undefined' && firebase.auth) {
                firebase.auth().signInWithEmailAndPassword(email, pass)
                    .then(res => this.handleUserLogin(res.user))
                    .catch(e => {
                        // Demo auto-signup if user not found
                        firebase.auth().createUserWithEmailAndPassword(email, pass)
                            .then(res => this.handleUserLogin(res.user))
                            .catch(err => alert(err.message));
                    });
            } else { this.login(); }
        },

        loginGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
                .then(res => this.handleUserLogin(res.user))
                .catch(e => alert(e.message));
        },

        updateDashboardStats() {
            const t = this.profile.turnover;
            const tax = (t * 0.15) / 100000;
            document.getElementById('finTotalPaid').innerText = "₹ " + tax.toFixed(1) + " L";
            document.getElementById('healthText').innerText = "85%";
            document.getElementById('healthBar').style.width = "85%";
        }
    };

    const portalUI = {
        openSidebar() { document.getElementById('sidebar').classList.add('active'); document.getElementById('sidebarOverlay').classList.remove('hidden'); },
        closeSidebar() { document.getElementById('sidebar').classList.remove('active'); document.getElementById('sidebarOverlay').classList.add('hidden'); }
    };

    // --- 3. CHECKLIST LOGIC ---
    window.app = {
        manualRun() {
            document.getElementById('initialInstruction').classList.add('hidden');
            const dash = document.getElementById('dashboardSection');
            dash.classList.remove('hidden');
            this.render();
        },
        render() {
            const container = document.getElementById('complianceBody');
            document.getElementById('totalCount').innerText = "8 Obligations";
            container.innerHTML = `<div class="p-4 bg-white border-2 rounded-xl mb-3"><b>Annual Return (AOC-4)</b><p class="text-xs text-slate-500">Due: 30th Oct</p></div>`;
        }
    };

    // --- 4. INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof firebase !== 'undefined') {
            try {
                firebase.initializeApp(firebaseConfig);
                // Auth listener for session persistence
                firebase.auth().onAuthStateChanged(u => { if(u) portalApp.handleUserLogin(u); });
            } catch (e) { portalApp.isOffline = true; }
        }
        router('home');
    });
</script>
</body>
</html>
